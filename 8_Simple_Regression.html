

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>単回帰分析 &#8212; Pythonで学ぶ入門計量経済学</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=ac02cc09edc035673794" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/myadmonitions.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=ac02cc09edc035673794" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=ac02cc09edc035673794"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-6SP1Y69WEX"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-6SP1Y69WEX');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '8_Simple_Regression';</script>
    <link rel="canonical" href="https://py4etrics.github.io/8_Simple_Regression.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="重回帰分析" href="9_Multiple_Regression.html" />
    <link rel="prev" title="計量経済学用語" href="list_of_terms.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    <p class="title logo__title">Pythonで学ぶ入門計量経済学</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Pythonの学習</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="part_1.html">目次と内容</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_Python_Basics.html">Pythonの基礎</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_NumPy.html">NumPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_Pandas.html">Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_Matplotlib.html">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_SciPy_stats.html">SciPy.stats</a></li>
<li class="toctree-l1"><a class="reference internal" href="6_things_to_note.html">Tipsと注意点</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Pythonを使った計量経済分析</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="part_2.html">目次と内容</a></li>
<li class="toctree-l1"><a class="reference internal" href="7_Review_of_Statistics.html">統計学の簡単な復習</a></li>
<li class="toctree-l1"><a class="reference internal" href="list_of_terms.html">計量経済学用語</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">単回帰分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="9_Multiple_Regression.html">重回帰分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_Residuals.html">残差診断</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_Inference.html">推論</a></li>
<li class="toctree-l1"><a class="reference internal" href="12_Asymptotics.html">大標本特性</a></li>
<li class="toctree-l1"><a class="reference internal" href="13_Dummies.html">質的変数と回帰分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="14_Hetero.html">不均一分散</a></li>
<li class="toctree-l1"><a class="reference internal" href="15_Pooling.html">プーリング・データとパネル・データ</a></li>
<li class="toctree-l1"><a class="reference internal" href="16_linearmodels.html"><code class="docutils literal notranslate"><span class="pre">linearmodels</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="17_Panel.html">パネル・データ分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="18_Zero_Conditional_Mean.html">GM仮定４が満たされない場合</a></li>
<li class="toctree-l1"><a class="reference internal" href="19_IV2SLS.html">操作変数法と２段階OLS</a></li>
<li class="toctree-l1"><a class="reference internal" href="20_LogitProbit.html">離散選択モデル</a></li>
<li class="toctree-l1"><a class="reference internal" href="21_TruncregTobitHeckit.html">制限従属変数モデル</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">番外編</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="part_3.html">目次と内容</a></li>
<li class="toctree-l1"><a class="reference internal" href="Descriptive_stats_vs_Graphs.html">記述統計とグラフ</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_source.html">Data</a></li>
<li class="toctree-l1"><a class="reference external" href="https://py4macro.github.io">Pythonで学ぶマクロ経済学 (中級＋レベル)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://py4basics.github.io">経済学のためのPython入門</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/Py4Etrics/py4etrics.github.io/source?urlpath=tree/8_Simple_Regression.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/Py4Etrics/py4etrics.github.io/blob/source/8_Simple_Regression.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>



<a href="https://github.com/Py4Etrics/py4etrics.github.io" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/8_Simple_Regression.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>単回帰分析</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">説明</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">データ</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">「手計算」</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#statsmodels"><code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>を使う</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">図</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">モデルの適合度</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">賃金の対数化</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ols">シミュレーション：<span class="math notranslate nohighlight">\(OLS\)</span>推定</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">母集団の考え方</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">プラン</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">シミュレーション</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">関数化</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">ループを使ってシミュレーション</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="chap-8-simple">
<span id="id1"></span><h1>単回帰分析<a class="headerlink" href="#chap-8-simple" title="Permalink to this heading">#</a></h1>
<div name="html-admonition" style="font-size: 0.8em">
<input type="button" onclick="location.href='https://translate.google.com/translate?hl=&sl=ja&tl=en&u='+window.location;" value="Google translation" style="color:#ffffff;background-color:#008080; height:25px" onmouseover="this.style.background='#99ccff'" onmouseout="this.style.background='#008080'"/> in English or the language of your choice.
</div><br><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">wooldridge</span>  <span class="c1"># wooldridgeのデータ・パッケージ</span>
<span class="kn">from</span> <span class="nn">statsmodels.formula.api</span> <span class="kn">import</span> <span class="n">ols</span>  <span class="c1"># 回帰分析のパッケージ</span>
<span class="kn">from</span> <span class="nn">see</span> <span class="kn">import</span> <span class="n">see</span>  <span class="c1"># 属性を調べるパッケージ</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span>  <span class="c1"># シミュレーションの計算を高速化する</span>
</pre></div>
</div>
</div>
</div>
<section id="id2">
<h2>説明<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h2>
<p>説明変数が１つの単回帰（Simple Regression）を考える。</p>
<div class="math notranslate nohighlight">
\[y_i=\beta_0+\beta_1 x_i + u_i\]</div>
<p>ここで使う変数の呼び名は複数あるので混同しないように。</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(y_i\)</span>： 被説明変数（explained variable）</p>
<ul>
<li><p>従属変数（dependent variable）</p></li>
<li><p>regressand</p></li>
</ul>
</li>
<li><p><span class="math notranslate nohighlight">\(x_i\)</span>： 説明変数（explanatory variable）</p>
<ul>
<li><p>独立変数（independent variable）</p></li>
<li><p>regressor</p></li>
</ul>
</li>
<li><p><span class="math notranslate nohighlight">\(u_i\)</span>： 誤差項（errors)</p>
<ul>
<li><p>観測不可能なランダムな要素</p></li>
<li><p>平均はゼロと仮定する（重回帰分析の章でより詳しく説明する）</p></li>
</ul>
</li>
<li><p><span class="math notranslate nohighlight">\(i=1,2,...n\)</span>：観測値のインデックス</p></li>
<li><p><span class="math notranslate nohighlight">\(\beta_0\)</span>：定数項（観測不可能なため推定する）</p></li>
<li><p><span class="math notranslate nohighlight">\(\beta_1\)</span>：スロープ係数（観測不可能なため推定する）</p></li>
</ul>
<hr class="docutils" />
<p><strong>最小二乗法推定法（Ordinary Least Squares; OLS）</strong></p>
<div class="math notranslate nohighlight">
\[\sum_{i=1}^n\left(y_i-\beta_0-\beta_1 x_i\right)^2\]</div>
<p>を最小化する<span class="math notranslate nohighlight">\(\beta_0\)</span>と<span class="math notranslate nohighlight">\(\beta_1\)</span>を選択すると以下を得る：</p>
<div class="math notranslate nohighlight">
\[
\hat{\beta}_0=\bar{y}-\hat{\beta}_1\bar{x},\qquad\qquad
\hat{\beta}_1=\frac{\text{Cov}(x,y)}{\text{Var}(x)}
\]</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">^</span></code>（ハット）がある変数（<span class="math notranslate nohighlight">\(\hat{\beta}_0\)</span>と<span class="math notranslate nohighlight">\(\hat{\beta}_1\)</span>）を<strong>OLS推定量</strong>と呼ぶ</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-</span></code>（バー）がある変数（例えば，<span class="math notranslate nohighlight">\(\bar{y}\)</span>）は平均値</p></li>
<li><p><span class="math notranslate nohighlight">\(\text{Cov}(x,y)=\)</span> <span class="math notranslate nohighlight">\(x\)</span>と<span class="math notranslate nohighlight">\(y\)</span>の共分散</p></li>
<li><p><span class="math notranslate nohighlight">\(\text{Var}(x)=\)</span> <span class="math notranslate nohighlight">\(x\)</span>の分散</p></li>
<li><p><span class="math notranslate nohighlight">\(x\)</span>のように添え字<span class="math notranslate nohighlight">\(i\)</span>を省いた場合は，<span class="math notranslate nohighlight">\(x_1\)</span>から<span class="math notranslate nohighlight">\(x_n\)</span>までの全ての観測値という意味（<span class="math notranslate nohighlight">\(y\)</span>も同じ）</p></li>
</ul>
<p>また以下を定義する。</p>
<ul class="simple">
<li><p>予測値 <span class="math notranslate nohighlight">\(\hat{y}_i\)</span></p></li>
</ul>
<div class="math notranslate nohighlight">
\[\hat{y}_i=\hat{\beta}_0 + \hat{\beta}_1x_i\]</div>
<ul class="simple">
<li><p>残差 <span class="math notranslate nohighlight">\(\hat{u}_i\)</span></p></li>
</ul>
<div class="math notranslate nohighlight">
\[\hat{u}_i=y_i-\hat{y}_i\]</div>
</section>
<section id="id3">
<h2>データ<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h2>
<p>Wooldridge (2019)で使われるデータセットは全て<code class="docutils literal notranslate"><span class="pre">wooldridge</span></code>のパッケージに含まれている。そのパッケージからからデータを読み込んで使うことにする。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>MacではTerminal、WindowsではGit Bashを使い、次のコマンドで<code class="docutils literal notranslate"><span class="pre">wooldridge</span></code>パッケージをインストールできる。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">wooldridge</span>
</pre></div>
</div>
</div>
<p>使う関数は<code class="docutils literal notranslate"><span class="pre">data()</span></code>であり，引数なしで実行するとデータセットのリストが表示される。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wooldridge</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  J.M. Wooldridge (2016) Introductory Econometrics: A Modern Approach,
  Cengage Learning, 6th edition.

  401k       401ksubs    admnrev       affairs     airfare
  alcohol    apple       approval      athlet1     athlet2
  attend     audit       barium        beauty      benefits
  beveridge  big9salary  bwght         bwght2      campus
  card       catholic    cement        census2000  ceosal1
  ceosal2    charity     consump       corn        countymurders
  cps78_85   cps91       crime1        crime2      crime3
  crime4     discrim     driving       earns       econmath
  elem94_95  engin       expendshares  ezanders    ezunem
  fair       fertil1     fertil2       fertil3     fish
  fringe     gpa1        gpa2          gpa3        happiness
  hprice1    hprice2     hprice3       hseinv      htv
  infmrt     injury      intdef        intqrt      inven
  jtrain     jtrain2     jtrain3       kielmc      lawsch85
  loanapp    lowbrth     mathpnl       meap00_01   meap01
  meap93     meapsingle  minwage       mlb1        mroz
  murder     nbasal      nyse          okun        openness
  pension    phillips    pntsprd       prison      prminwge
  rdchem     rdtelec     recid         rental      return
  saving     sleep75     slp75_81      smoke       traffic1
  traffic2   twoyear     volat         vote1       vote2
  voucher    wage1       wage2         wagepan     wageprc
  wine
</pre></div>
</div>
</div>
</div>
<p>この中にある<code class="docutils literal notranslate"><span class="pre">wage1</span></code>を使う。データ・セットを読み込むには、引数にデータ・セット名を文字列として入力する。返り値は<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>であり、
回帰分析に使うために<code class="docutils literal notranslate"><span class="pre">df</span></code>に割り当てる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">wooldridge</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;wage1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>オプション<code class="docutils literal notranslate"><span class="pre">description=True</span></code>を追加するとデータの説明を表示することができる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wooldridge</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;wage1&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>name of dataset: wage1
no of variables: 24
no of observations: 526

+----------+---------------------------------+
| variable | label                           |
+----------+---------------------------------+
| wage     | average hourly earnings         |
| educ     | years of education              |
| exper    | years potential experience      |
| tenure   | years with current employer     |
| nonwhite | =1 if nonwhite                  |
| female   | =1 if female                    |
| married  | =1 if married                   |
| numdep   | number of dependents            |
| smsa     | =1 if live in SMSA              |
| northcen | =1 if live in north central U.S |
| south    | =1 if live in southern region   |
| west     | =1 if live in western region    |
| construc | =1 if work in construc. indus.  |
| ndurman  | =1 if in nondur. manuf. indus.  |
| trcommpu | =1 if in trans, commun, pub ut  |
| trade    | =1 if in wholesale or retail    |
| services | =1 if in services indus.        |
| profserv | =1 if in prof. serv. indus.     |
| profocc  | =1 if in profess. occupation    |
| clerocc  | =1 if in clerical occupation    |
| servocc  | =1 if in service occupation     |
| lwage    | log(wage)                       |
| expersq  | exper^2                         |
| tenursq  | tenure^2                        |
+----------+---------------------------------+

These are data from the 1976 Current Population Survey, collected by
Henry Farber when he and I were colleagues at MIT in 1988.
</pre></div>
</div>
</div>
</div>
<p>このデータを使い次の問題を考える。</p>
<blockquote>
<div><p>教育水準は賃金にどのような影響を与えるのか</p>
</div></blockquote>
<ul class="simple">
<li><p>被説明変数：<code class="docutils literal notranslate"><span class="pre">wage</span></code>（平均時給、単位：米ドル）</p></li>
<li><p>説明変数：<code class="docutils literal notranslate"><span class="pre">educ</span></code>（教育年数、単位：年）</p></li>
</ul>
<p>まず関係する変数だけを取り出してみる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;wage&#39;</span><span class="p">,</span><span class="s1">&#39;educ&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<p>最初の3行の表示をしてみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wage</th>
      <th>educ</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3.10</td>
      <td>11</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3.24</td>
      <td>12</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.00</td>
      <td>11</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>次に<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>の特徴を確認する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 526 entries, 0 to 525
Data columns (total 2 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   wage    526 non-null    float64
 1   educ    526 non-null    int64  
dtypes: float64(1), int64(1)
memory usage: 8.3 KB
</pre></div>
</div>
</div>
</div>
<p>また記述統計も必ず確認するように。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wage</th>
      <th>educ</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>526.000000</td>
      <td>526.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>5.896103</td>
      <td>12.562738</td>
    </tr>
    <tr>
      <th>std</th>
      <td>3.693086</td>
      <td>2.769022</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.530000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>3.330000</td>
      <td>12.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>4.650000</td>
      <td>12.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>6.880000</td>
      <td>14.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>24.980000</td>
      <td>18.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">.head()</span></code>，<code class="docutils literal notranslate"><span class="pre">.tail()</span></code>，<code class="docutils literal notranslate"><span class="pre">.info()</span></code>そして<code class="docutils literal notranslate"><span class="pre">.describe()</span></code>を使い<code class="docutils literal notranslate"><span class="pre">df</span></code>の情報を確認し，データのイメージ作りをすることは回帰分析に役立つだろう。</p>
</section>
<section id="id4">
<h2>「手計算」<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Python</span></code>では回帰分析の計算を自動化するパッケージが提供されており、後ほどその１つを紹介する。その前に、自動計算にはどのようなコードが使われているかを感じてもらうために「手計算」で、即ち、上で示した<span class="math notranslate nohighlight">\(\hat{\beta}_0\)</span>と<span class="math notranslate nohighlight">\(\hat{\beta}_1\)</span>の式を使い係数の推定値を計算してみる。まず分散共分散行列を計算する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat_wage_educ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;wage&#39;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;educ&#39;</span><span class="p">])</span>
<span class="n">mat_wage_educ</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[13.63888436,  4.150864  ],
       [ 4.150864  ,  7.66748506]])
</pre></div>
</div>
</div>
</div>
<p>共分散の値を<code class="docutils literal notranslate"><span class="pre">cov_wage_edu</span></code>に割り当てる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cov_wage_educ</span> <span class="o">=</span> <span class="n">mat_wage_educ</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">cov_wage_educ</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4.150863998572981
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">wage</span></code>と<code class="docutils literal notranslate"><span class="pre">educ</span></code>の分散は次のコードで取得できる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat_wage_educ</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">mat_wage_educ</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(13.638884363775006, 7.667485062466053)
</pre></div>
</div>
</div>
</div>
<p>次のように計算しても同じ値となる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">var_wage</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;wage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">var_educ</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;educ&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">var_wage</span><span class="p">,</span> <span class="n">var_educ</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(13.638884363775007, 7.667485062466051)
</pre></div>
</div>
</div>
</div>
<p>それぞれの変数の平均を計算する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_wage</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;wage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">mean_educ</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;educ&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>上の式に従って<span class="math notranslate nohighlight">\(\beta_1\)</span>の推定値 <span class="math notranslate nohighlight">\(\left(\hat{\beta}_1\right)\)</span>を計算する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">b1hat</span> <span class="o">=</span> <span class="n">cov_wage_educ</span> <span class="o">/</span> <span class="n">var_educ</span>
<span class="n">b1hat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5413592546651745
</pre></div>
</div>
</div>
</div>
<p><strong>＜結果の解釈＞</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">b1hat</span></code>は次式の推定結果である。</p>
<div class="math notranslate nohighlight">
\[y = \beta_0+\beta_1x+u\]</div>
<p>この式を<span class="math notranslate nohighlight">\(x\)</span>について微分すると</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\dfrac{dy}{dx}=\dfrac{y\text{の変化}}{x\text{の増加}}
=
\left(
\begin{array}{l}
    x\text{が1単位増加した}\\
    \text{場合の}yの\text{変化}
    \phantom{春}
\end{array}
\right)
=\beta_1
\end{split}\]</div>
<p>となる。即ち，<span class="math notranslate nohighlight">\(\beta_1\)</span>は教育年数が１年増加した場合，平均時給は何ドル変化するかを示している。OLS推定結果は教育年数が１年増えると賃金は約0.54ドル上昇することを示している。</p>
<p>同様に<span class="math notranslate nohighlight">\(\beta_0\)</span>の推定値 <span class="math notranslate nohighlight">\(\left(\hat{\beta}_0\right)\)</span>も計算する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">b0hat</span> <span class="o">=</span> <span class="n">mean_wage</span> <span class="o">-</span> <span class="n">b1hat</span> <span class="o">*</span> <span class="n">mean_educ</span>
<span class="n">b0hat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.904851611957211
</pre></div>
</div>
</div>
</div>
</section>
<section id="statsmodels">
<span id="sec-8-statsmodels"></span><h2><code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>を使う<a class="headerlink" href="#statsmodels" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Python</span></code>では簡単なコードで回帰分析に関する多くの計算を行うことができるパッケージが提供されている。その内、代表的なパッケージが<code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>である。次の順番で使い方を説明する。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ols</span></code>サブパッケージを読み込む</p></li>
<li><p>回帰式を定義する</p></li>
<li><p>推定値の自動計算</p></li>
</ul>
<p><strong>Step 1: サブパッケージの読み込み</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>には多くのサブパッケージや関数があるが，ここでは回帰式を文字列で書くことができる<code class="docutils literal notranslate"><span class="pre">ols</span></code>関数をつかう。（他のコードの書き方もあるが，他のトピックで扱う。）<code class="docutils literal notranslate"><span class="pre">ols</span></code>はこのページの冒頭で次のコードでインポートされている。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.formula.api</span> <span class="kn">import</span> <span class="n">ols</span>
</pre></div>
</div>
<p><strong>Step 2: 回帰式の定義</strong></p>
<ul class="simple">
<li><p>式を<code class="docutils literal notranslate"><span class="pre">''</span></code>で囲む（文字列）</p></li>
<li><p>定数項である（<span class="math notranslate nohighlight">\(\beta_0\)</span>）は自動的に挿入される。</p>
<ul>
<li><p>定数を省きたい場合は式に<code class="docutils literal notranslate"><span class="pre">-1</span></code>を加える。</p></li>
<li><p>後に扱う<code class="docutils literal notranslate"><span class="pre">linearmodels</span></code>パッケージでは，定数が自動的に挿入されないので要注意。</p></li>
</ul>
</li>
</ul>
<hr class="docutils" />
<p>定数項がある場合：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">被説明変数</span> <span class="o">~</span> <span class="n">説明変数</span>
</pre></div>
</div>
<p>定数項がない場合：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">被説明変数</span> <span class="o">~</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">説明変数</span>
</pre></div>
</div>
<hr class="docutils" />
<p><code class="docutils literal notranslate"><span class="pre">wage</span></code>を被説明変数にし，定数項を加えて<code class="docutils literal notranslate"><span class="pre">educ</span></code>を説明変数をする場合，次のように書くことになる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;wage ~ educ&#39;</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Step 3: 自動計算</strong></p>
<p>まず自動計算の準備として計算の対象となるもの（インスタンスと呼ばれるオブジェクト）を生成し、ここでは”model”の省略形の変数<code class="docutils literal notranslate"><span class="pre">mod</span></code>に割り当てる（<code class="docutils literal notranslate"><span class="pre">mod</span></code>でなくとも好きな変数名でOK）。ここで第１引数は上で定義した回帰式，第２引数<code class="docutils literal notranslate"><span class="pre">data</span></code>は使用するデータをを指定する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mod</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">mod</span></code>の属性を調べてみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">see</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    &lt;                  &lt;=                 ==                 !=
    &gt;                  &gt;=                 dir()              hash()
    help()             repr()             str()              .data
    .df_model          .df_resid          .endog             .endog_names
    .exog              .exog_names        .fit()
    .fit_regularized()                    .formula           .from_formula()
    .get_distribution()                   .hessian()         .hessian_factor()
    .information()     .initialize()      .k_constant        .loglike()
    .nobs              .pinv_wexog        .predict()         .rank
    .score()           .weights           .wendog            .wexog
    .whiten()
</pre></div>
</div>
</div>
</div>
<p>この中にOLS関連の計算を一瞬で実行するメソッド<code class="docutils literal notranslate"><span class="pre">fit()</span></code>が準備されており、それを使い結果を<code class="docutils literal notranslate"><span class="pre">res</span></code>に割り当てる（<code class="docutils literal notranslate"><span class="pre">res</span></code>はresultの略）。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>上の２つを分けずに一行で書いても良い。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">res</span></code>の属性を確認してみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">see</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    &lt;                    &lt;=                   ==                   !=
    &gt;                    &gt;=                   dir()                hash()
    help()               repr()               str()                .HC0_se
    .HC1_se              .HC2_se              .HC3_se              .aic
    .bic                 .bse                 .centered_tss
    .compare_f_test()    .compare_lm_test()
    .compare_lr_test()                        .condition_number    .conf_int()
    .conf_int_el()       .cov_HC0             .cov_HC1             .cov_HC2
    .cov_HC3             .cov_kwds            .cov_params()        .cov_type
    .df_model            .df_resid            .eigenvals           .el_test()
    .ess                 .f_pvalue            .f_test()
    .fittedvalues        .fvalue              .get_influence()
    .get_prediction()    .get_robustcov_results()
    .info_criteria()     .initialize()        .k_constant          .llf
    .load()              .model               .mse_model           .mse_resid
    .mse_total           .nobs                .normalized_cov_params
    .outlier_test()      .params              .predict()           .pvalues
    .remove_data()       .resid               .resid_pearson       .rsquared
    .rsquared_adj        .save()              .scale               .ssr
    .summary()           .summary2()          .t_test()
    .t_test_pairwise()                        .tvalues
    .uncentered_tss      .use_t               .wald_test()
    .wald_test_terms()                        .wresid
</pre></div>
</div>
</div>
</div>
<p>例えば，上のリストの中に<code class="docutils literal notranslate"><span class="pre">.params</span></code>とあるが，この属性を使い係数の推定値を取り出すことができる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="o">.</span><span class="n">params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Intercept   -0.904852
educ         0.541359
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>「手計算」での計算結果と同じだと確認できる。</p>
<p>また<code class="docutils literal notranslate"><span class="pre">wage</span></code>の予測値は<code class="docutils literal notranslate"><span class="pre">res.fittedvalues</span></code>もしくは<code class="docutils literal notranslate"><span class="pre">res.predict()</span></code>で得ることができる。<code class="docutils literal notranslate"><span class="pre">res.fittedvalues</span></code>は属性であり<code class="docutils literal notranslate"><span class="pre">res.predict()</span></code>はメソッドであるが、後者は引数がない場合は前者と同じ結果を返すことになる。</p>
<p>上のリストが示すように<code class="docutils literal notranslate"><span class="pre">res</span></code>には多くの情報が詰まっており，これらを駆使して図を描いたり推定値の検定をおこなうことになる。</p>
<p>この中にあるメソッド<code class="docutils literal notranslate"><span class="pre">summary()</span></code>を使うと，主な結果がまとめられた表を出力することができる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                   wage   R-squared:                       0.165
Model:                            OLS   Adj. R-squared:                  0.163
Method:                 Least Squares   F-statistic:                     103.4
Date:                Mon, 09 Oct 2023   Prob (F-statistic):           2.78e-22
Time:                        10:18:50   Log-Likelihood:                -1385.7
No. Observations:                 526   AIC:                             2775.
Df Residuals:                     524   BIC:                             2784.
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept     -0.9049      0.685     -1.321      0.187      -2.250       0.441
educ           0.5414      0.053     10.167      0.000       0.437       0.646
==============================================================================
Omnibus:                      212.554   Durbin-Watson:                   1.824
Prob(Omnibus):                  0.000   Jarque-Bera (JB):              807.843
Skew:                           1.861   Prob(JB):                    3.79e-176
Kurtosis:                       7.797   Cond. No.                         60.2
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<p>ここで<code class="docutils literal notranslate"><span class="pre">print()</span></code>関数を使ったが、使わなくとも同じ内容を表示できるので試してみよう。</p>
<p>また，この表は３つの表から構成されており，必要な部分だけを表示することも可能である。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">res</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">res</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
<p>例えば，係数の推定値に関する基本的な統計量だけを表示するには以下のようにすれば良い。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept     -0.9049      0.685     -1.321      0.187      -2.250       0.441
educ           0.5414      0.053     10.167      0.000       0.437       0.646
==============================================================================
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">statsmodels</span> <span class="pre">13.0</span></code>では<code class="docutils literal notranslate"><span class="pre">.summary()</span></code>に引数<code class="docutils literal notranslate"><span class="pre">slim</span></code>（デフォルトは<code class="docutils literal notranslate"><span class="pre">False</span></code>）が追加されており，<code class="docutils literal notranslate"><span class="pre">.tables</span></code>を使わずに次のコードで簡略化された表を表示できる。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">slim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><strong>＜表の説明＞</strong></p>
<p>表は3つのセクションから構成されている。</p>
<ul class="simple">
<li><p>上段にはOLS推定の基本的な情報が表示されている。</p>
<ul>
<li><p>左側</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Dep.</span> <span class="pre">Variable</span></code>：被説明変数</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Model</span></code>：モデル</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Method</span></code>：手法</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Data</span></code>：日にち</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Time</span></code>：時間</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">No.</span> <span class="pre">Observation</span></code>：標本の大きさ</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Df</span> <span class="pre">Residuals</span></code>：残差の自由度</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Df</span> <span class="pre">Model</span></code>：モデルの自由度（定数項以外の説明変数の数）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Covariance</span> <span class="pre">Type</span></code>：共分散のタイプ</p></li>
</ul>
</li>
<li><p>右側</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">R-squared</span></code>：決定係数</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">adj.</span> <span class="pre">R-squared</span></code>：自由度調整済み決定係数</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">F-statistic</span></code>：<span class="math notranslate nohighlight">\(F\)</span>統計量</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Prob</span> <span class="pre">(F-statistic)</span></code>：<span class="math notranslate nohighlight">\(F\)</span>値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Log-Likelihood</span></code>：対数尤度</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AIC</span></code>：赤池情報量規準</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BIC</span></code>：ベイズ情報量規準</p></li>
</ul>
</li>
</ul>
</li>
<li><p>中段には主な推定結果が表示される。</p>
<ul>
<li><p>列ラベル</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">coef</span></code>：係数</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">std</span> <span class="pre">err</span></code>：標準誤差</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">t</span></code>：<span class="math notranslate nohighlight">\(t\)</span>値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">P&gt;|t|</span></code>：<span class="math notranslate nohighlight">\(p\)</span>値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[0.025,0.975]</span></code>：信頼区間（5%)</p></li>
</ul>
</li>
<li><p>行ラベル</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Intercept</span></code>：定数項</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tfp_relative</span></code>：説明変数（選択する変数によって変わる）</p></li>
</ul>
</li>
</ul>
</li>
<li><p>下段には様々な検定などに関する数値が並んでいる。</p>
<ul>
<li><p>左側</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Omnibus</span></code>：オムニバス検定統計量（帰無仮説：残差は正規分布に従う）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Prob(Omnibus)</span></code>：オムニバス検定<span class="math notranslate nohighlight">\(p\)</span>値（帰無仮説：残差は正規分布に従う）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Skew</span></code>：残差の歪度（正規分布であれば<code class="docutils literal notranslate"><span class="pre">0</span></code>）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Kurtosis</span></code>：残差の尖度（正規分布であれば<code class="docutils literal notranslate"><span class="pre">3</span></code>）</p></li>
</ul>
</li>
<li><p>右側</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Durbin-Watson</span></code>：ダービン・ワトソン統計量（残差の自己相関の検定）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Jarque-Bera</span> <span class="pre">(JB)</span></code>：ジャーク・ベラ検定統計量（帰無仮説：残差は正規分布に従う）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Prob(JB)</span></code>：ジャーク・ベラ検定<span class="math notranslate nohighlight">\(p\)</span>値（帰無仮説：残差は正規分布に従う）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Cond.</span> <span class="pre">No.</span></code>：条件指数（Condition Index）の最大値（多重共線性を確認するための指標であり，単回帰分析では無視して良い。一方，<code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>では該当する行列を標準化して計算していないため変数の値の大きさに依存することになり，使い難い指標となっている。重回帰分析においての多重共線性の確認については<a class="reference internal" href="9_Multiple_Regression.html#sec-9-vif"><span class="std std-ref">ここで</span></a>説明する手法を使うことを勧める。）</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OLS推定結果を割り当てた<code class="docutils literal notranslate"><span class="pre">res</span></code>には，ここで説明した以外に数多くの属性が存在する。それらに関する説明は<a class="reference external" href="https://www.statsmodels.org/stable/generated/statsmodels.regression.linear_model.RegressionResults.html">このサイト</a>を参照すること。</p>
</section>
<section id="id5">
<h2>図<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h2>
<p>回帰分析の結果を図示するために、まず予測値の取得する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wage_hat</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">fittedvalues</span>
</pre></div>
</div>
</div>
</div>
<p>データの散布図と回帰直線を図示する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wage_hat</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">fittedvalues</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s1">&#39;educ&#39;</span><span class="p">,</span> <span class="s1">&#39;wage&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;educ&#39;</span><span class="p">],</span><span class="n">wage_hat</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Education&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Wage&#39;</span><span class="p">)</span>
<span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2ecd56bacea13ad916917efeae037fb940162c553efa4d5ef5aaa4a3e1024191.png" src="_images/2ecd56bacea13ad916917efeae037fb940162c553efa4d5ef5aaa4a3e1024191.png" />
</div>
</div>
</section>
<section id="id6">
<h2>モデルの適合度<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h2>
<p>モデルの適合度を確認するために次を定義する。</p>
<ul class="simple">
<li><p>SST（Total Sum of Squares; 全変動の平方和）</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\text{SST}=\sum_{i=1}^n\left(y_i-\bar{y}\right)^2=(n-1)\cdot\text{Var}(y)\]</div>
<ul class="simple">
<li><p>SSE（Explained Sum of Squares; 回帰変動の平方和）</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\text{SSE}=\sum_{i=1}^n\left(\hat{y}_i-\bar{y}\right)^2=(n-1)\cdot\text{Var}\left(\hat{y}\right)
\]</div>
<ul class="simple">
<li><p>SSR（Residual Sum of Squares; 残差変動の平方和）</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\text{SSR}=\sum_{i=1}^n\left(\hat{u}_i-0\right)^2=(n-1)\cdot\text{Var}\left(\hat{u}\right)
\]</div>
<p>ここで，<span class="math notranslate nohighlight">\(\text{Var}(z)=\dfrac{1}{n-1}\sum_{i=1}^n\left(z_i-\bar{z}\right)^2\)</span>。これらを使い決定係数と自由度修正後の決定係数を定義する。</p>
<hr class="docutils" />
<ul class="simple">
<li><p>決定係数</p></li>
</ul>
<div class="math notranslate nohighlight">
\[R^2=\frac{SSE}{SST}=1-\frac{SSR}{SST}\]</div>
<div class="math notranslate nohighlight">
\[
R^2
=\frac{\text{Var}\left(\hat{y}\right)}{\text{Var}\left(y\right)}
=1-\frac{\text{Var}\left(\hat{u}\right)}{\text{Var}\left(y\right)}
\]</div>
<ul class="simple">
<li><p>自由度修正後の決定係数</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\overline{R}^2=1-(1-R^2)\frac{n-1}{n-k-1}\]</div>
<p>ここで，<span class="math notranslate nohighlight">\(k=\)</span> <strong>定数項以外の説明変数の数</strong>　（上の例では<span class="math notranslate nohighlight">\(k=1\)</span>）</p>
<p>ここで説明した変数の値は，上の例の<code class="docutils literal notranslate"><span class="pre">res</span></code>の属性として取得できる。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">nobs</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">df_model</span>
<span class="n">n</span><span class="o">-</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">df_resid</span>
<span class="n">SST</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">centered_tss</span>
<span class="n">SSE</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">ess</span>
<span class="n">SSR</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">ssr</span>
<span class="n">決定係数</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">rsquared</span>
<span class="n">修正済み決定係数</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">rsquared_adj</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">nobs</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">df_model</span>
<span class="c1"># n-k-1 = res.df_resid</span>
<span class="n">SST</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">centered_tss</span>
<span class="n">SSE</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">ess</span>
<span class="n">SSR</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">ssr</span>
</pre></div>
</div>
</div>
</div>
<p><strong>決定係数</strong></p>
<p>上の定義を使うと次のように計算できる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="o">-</span><span class="n">SSR</span><span class="o">/</span><span class="n">SST</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.16475751099205127
</pre></div>
</div>
</div>
</div>
<p>また次のように計算することも可能である。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">u_hat</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">resid</span>  <span class="c1"># 残差</span>
<span class="n">wage</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;wage&#39;</span><span class="p">]</span>  <span class="c1"># 被説明変数</span>
<span class="n">R2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">u_hat</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">wage</span><span class="p">)</span>
<span class="n">R2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.16475751099205116
</pre></div>
</div>
</div>
</div>
<p>しかし「手計算」よりも<code class="docutils literal notranslate"><span class="pre">res</span></code>の属性<code class="docutils literal notranslate"><span class="pre">.rsquared</span></code>を使う方がより簡単である。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="o">.</span><span class="n">rsquared</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.16475751099205127
</pre></div>
</div>
</div>
</div>
<p><strong>修正済み決定係数</strong></p>
<p>上の定義を使うと次のように計算できる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adjR2</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">R2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">adjR2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.16316353677638717
</pre></div>
</div>
</div>
</div>
<p>一方で修正済み決定係数を取得するメソッドは<code class="docutils literal notranslate"><span class="pre">.rsquared_adj</span></code>である。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="o">.</span><span class="n">rsquared_adj</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.16316353677638717
</pre></div>
</div>
</div>
</div>
</section>
<section id="id7">
<h2>賃金の対数化<a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h2>
<p>上の回帰分析では被説明変数<code class="docutils literal notranslate"><span class="pre">wage</span></code>をそのまま使ったが，労働経済学では賃金の対数をとり推定するのが一般的である。そのような式を賃金方程式と呼ぶ。その考えに沿って，ここでは<code class="docutils literal notranslate"><span class="pre">wage</span></code>の自然対数変換をおこない回帰分析をおこなう。まず対数化賃金お変数を作成する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;wage_log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;wage&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;wage_log ~ educ&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      0.5838      0.097      5.998      0.000       0.393       0.775
educ           0.0827      0.008     10.935      0.000       0.068       0.098
==============================================================================
</pre></div>
</div>
</div>
</div>
<p><strong>＜結果の解釈＞</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">res</span></code>は次式の推定結果である。</p>
<div class="math notranslate nohighlight">
\[\ln y = \beta_0+\beta_1x+u\]</div>
<p>この式を<span class="math notranslate nohighlight">\(x\)</span>について微分すると</p>
<div class="math notranslate nohighlight">
\[\dfrac{d\ln y}{dx}=\dfrac{dy/y}{dx}=\dfrac{y\text{の%変化}}{dx}=\beta_1\]</div>
<p>となる。即ち，<span class="math notranslate nohighlight">\(\beta_1\)</span>は<span class="math notranslate nohighlight">\(x\)</span>（教育年数）が一単位増加した場合，<span class="math notranslate nohighlight">\(y\)</span>（賃金）が何％変化するかを示している。この値は教育の収益率である。OLS推定結果は教育年数が１年増えると賃金は約8.3%増加することを示している。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>上の例では<code class="docutils literal notranslate"><span class="pre">wage_log</span></code>の変数を作成し計算したが、変数変換のコードを回帰式に直接書く方法もある。次章で説明することにする。</p>
</div>
<p>結果を図示しよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 予測値の取得</span>
<span class="n">wage_log_hat</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">fittedvalues</span>

<span class="c1"># 散布図と回帰曲線</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s1">&#39;educ&#39;</span><span class="p">,</span> <span class="s1">&#39;wage_log&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;educ&#39;</span><span class="p">],</span> <span class="n">wage_log_hat</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Education&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Log of Wage&#39;</span><span class="p">)</span>
<span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/035bcec970a631bb0f4c2f700af12e876d331113820abe3242fcc7c1ed9558e3.png" src="_images/035bcec970a631bb0f4c2f700af12e876d331113820abe3242fcc7c1ed9558e3.png" />
</div>
</div>
</section>
<section id="ols">
<h2>シミュレーション：<span class="math notranslate nohighlight">\(OLS\)</span>推定<a class="headerlink" href="#ols" title="Permalink to this heading">#</a></h2>
<p>上ではデータを使い「手計算」と<code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>を使い係数を計算したが，ここではOLS推定の「意味」をシミュレーションを使って考えてみることにする。</p>
<section id="id8">
<h3>母集団の考え方<a class="headerlink" href="#id8" title="Permalink to this heading">#</a></h3>
<p>母集団とは分析の対象となる共通の属性などを持つ個人・企業・産業・地域・国などの集合体といえる。ここで重要な点は母集団の大きさとランダム抽出の関係を理解することである。次の２つの例を使って考えてみよう。</p>
<ul class="simple">
<li><p>「今年の人間の平均身長」を知りたいとしよう。この場合の母集団は地球上の全ての人間である。しかし，全員の身長を測るのはあまりにも費用が高いため，標本を集め，その平均から「人間の平均身長」を推定することが可能である（<a class="reference external" href="https://ja.wikipedia.org/wiki/%E5%A4%A7%E6%95%B0%E3%81%AE%E6%B3%95%E5%89%87">参照</a>）。この場合「標本の大きさ<span class="math notranslate nohighlight">\(&lt;\)</span>母集団の大きさ」となる。</p></li>
<li><p>「今年のOECD諸国のGDP」についての何らかの統計量を計算したいとしよう。2021年現在でOECDには38カ国のメンバー国があり，GDPのデータは簡単に入手可能である。これは「標本の大きさ<span class="math notranslate nohighlight">\(=\)</span>母集団の大きさ」という意味なのだろうか。そうだとすれば，標本ではなく母集団全てのデータを扱うことになり，標本の概念である標準誤差などは意味がなくなることになる。しかし「標本の大きさ<span class="math notranslate nohighlight">\(&lt;\)</span>母集団」と解釈できる２つの考え方がある。</p>
<ol class="arabic simple">
<li><p>時間は「無限」と考えることができる。この考えに従うと、38カ国のGDPデータも「無限」に存在することになる（OECDが存在する限りという意味での「無限」）。従って、ある時点の38カ国のGDPのデータは「無限」の母集団から抽出されたランダム変数と考えることができる。国と時間の概念で考えると母集団の大きさは非常に大きいと解釈できる。</p></li>
<li><p>確率変数とは実現可能な数値から１つを実現させる関数である。またGDP自体は確率変数として解釈する方が自然である（<a class="reference internal" href="9_Multiple_Regression.html#sec-9-assumptions"><span class="std std-ref">「重回帰分析」</span></a>)で説明する仮定２を参照）。従って，38カ国の<strong>実現可能なGDPの値が母集団</strong>となる。今年度のみでの実現可能なGDPは無数にあるため，この解釈によると「標本の大きさ<span class="math notranslate nohighlight">\(&lt;\)</span>母集団の大きさ」となる。</p></li>
</ol>
</li>
</ul>
</section>
<section id="id9">
<h3>プラン<a class="headerlink" href="#id9" title="Permalink to this heading">#</a></h3>
<p><strong>＜Step 1＞</strong></p>
<ul>
<li><p>母集団の大きさは指定しない。</p></li>
<li><p>母集団のデータを生成する回帰式（母集団回帰式）を定義する。</p>
<div class="math notranslate nohighlight">
\[Y = \beta_0 + \beta_1 X + U\]</div>
<ul class="simple">
<li><p>説明変数<span class="math notranslate nohighlight">\(X\)</span>と誤差項<span class="math notranslate nohighlight">\(U\)</span>はランダム変数であり，従って<span class="math notranslate nohighlight">\(Y\)</span>もランダム変数である。</p></li>
</ul>
</li>
<li><p>母集団から標本を1組抽出し，標本の大きさを<span class="math notranslate nohighlight">\(n\)</span>とする。</p>
<ul>
<li><p>抽出された値はランダム変数の実現値である。</p>
<div class="math notranslate nohighlight">
\[(y_1,x_1),\;(y_2,x_2),.....(y_n,x_n)\]</div>
</li>
<li><p>仮定</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(X\)</span>は正規分布に従う <span class="math notranslate nohighlight">\(\Rightarrow\)</span> <span class="math notranslate nohighlight">\(x_1,\;x_2,..x_n\)</span>は<span class="math notranslate nohighlight">\(X\)</span>の実現値。</p></li>
<li><p><span class="math notranslate nohighlight">\(U\)</span>は正規分布に従う <span class="math notranslate nohighlight">\(\Rightarrow\)</span> <span class="math notranslate nohighlight">\(u_1,\;u_2,..u_n\)</span>は<span class="math notranslate nohighlight">\(U\)</span>の実現値。</p></li>
<li><p><span class="math notranslate nohighlight">\(X\)</span>と<span class="math notranslate nohighlight">\(U\)</span>は無相関。</p></li>
<li><p>実現値<span class="math notranslate nohighlight">\(y_1,\;y_2,..y_n\)</span>は母集団回帰式に従って生成される。</p>
<div class="math notranslate nohighlight">
\[y_i = \beta_0 + \beta_1 x_i + u_i,\qquad i=1,2,3,....n\]</div>
</li>
</ul>
</li>
<li><p><span class="math notranslate nohighlight">\(\beta_0\)</span>と<span class="math notranslate nohighlight">\(\beta_1\)</span>は未知であり，<span class="math notranslate nohighlight">\(u_i\)</span>も観測不可能</p></li>
</ul>
</li>
</ul>
<p><strong>＜Step 2＞</strong></p>
<ul class="simple">
<li><p>Step 1で抽出した標本を使い回帰分析を行い，母集団の回帰式のパラメータを推定する。</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\hat{\beta}_0\)</span>，<span class="math notranslate nohighlight">\(\hat{\beta}_1\)</span></p></li>
</ul>
</li>
</ul>
</section>
<section id="id10">
<h3>シミュレーション<a class="headerlink" href="#id10" title="Permalink to this heading">#</a></h3>
<p>母集団のパラメータを設定する。これはパラメータの真の値であり、この値を推定するのが回帰分析となる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">b0</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># 定数項</span>
<span class="n">b1</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># 説明変数の係数</span>
<span class="n">su</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># 誤差項の標準偏差</span>
</pre></div>
</div>
</div>
</div>
<p>標本の大きさ</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">30</span>
</pre></div>
</div>
</div>
</div>
<p>標本を抽出するが、次の無作為なプロセスを通して生成されるとする。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">su</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">b0</span> <span class="o">+</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">u</span>
</pre></div>
</div>
</div>
</div>
<p>このデータから<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>を作成する。<code class="docutils literal notranslate"><span class="pre">()</span></code>の中の<code class="docutils literal notranslate"><span class="pre">{}</span></code>は辞書である。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_sim</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;X&#39;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span><span class="n">y</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>を使って<code class="docutils literal notranslate"><span class="pre">OLS</span></code>推定する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;Y ~ X&#39;</span>
<span class="n">res_sim</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_sim</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>係数の推定値を表示する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_sim</span><span class="o">.</span><span class="n">params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Intercept    1.491380
X            0.891078
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>母集団パラメータと比べると，推定誤差が発生していることがわかる。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ランダム変数を発生させ回帰分析を行っていることに注意しよう。ここで生成したランダム変数は、読者が生成したランダム変数とは異なる。従って，係数の推定値も異なることになる。</p>
</div>
</section>
<section id="id11">
<h3>関数化<a class="headerlink" href="#id11" title="Permalink to this heading">#</a></h3>
<p>次に，上で行ったシミュレーションのコードを関数にまとめることにする。</p>
<p><code class="docutils literal notranslate"><span class="pre">def</span></code>を使い<code class="docutils literal notranslate"><span class="pre">my_sim</span></code>という名前の関数を作成する。</p>
<ul class="simple">
<li><p>引数</p>
<ul>
<li><p>標本の大きさ：<code class="docutils literal notranslate"><span class="pre">n</span></code></p></li>
<li><p>真の定数項：<code class="docutils literal notranslate"><span class="pre">b0</span></code>（デフォルトは<code class="docutils literal notranslate"><span class="pre">1</span></code>）</p></li>
<li><p>真のスロープ係数：<code class="docutils literal notranslate"><span class="pre">b1</span></code>（デフォルトは<code class="docutils literal notranslate"><span class="pre">1</span></code>）</p></li>
<li><p>誤差項の標準偏差：<code class="docutils literal notranslate"><span class="pre">su</span></code>（デフォルトは<code class="docutils literal notranslate"><span class="pre">1</span></code>）</p></li>
</ul>
</li>
<li><p>戻り値</p>
<ul>
<li><p>定数項とスロープ係数の推定値（<code class="docutils literal notranslate"><span class="pre">pandas.Series</span></code>）</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_sim</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">b0</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">b1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">su</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>  <span class="c1"># nを指定する，　他はデフォルトを設定</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">su</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">b0</span> <span class="o">+</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">u</span>
    
    <span class="n">df_sim</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;X&#39;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span><span class="n">y</span><span class="p">})</span>
    
    <span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;Y ~ X&#39;</span>
    <span class="n">res_sim</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_sim</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">res_sim</span><span class="o">.</span><span class="n">params</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">my_sim()</span></code>関数の中身は，上のコードと殆ど変わらないことに気付くはずである。</p>
<p>標本の大きさを指定して関数を実行してみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_sim</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Intercept    1.035378
X            0.988431
dtype: float64
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">b0</span></code>，<code class="docutils literal notranslate"><span class="pre">b1</span></code>，<code class="docutils literal notranslate"><span class="pre">su</span></code>変えて計算してみよう。</p>
<hr class="docutils" />
<p>シミュレーションで同じ計算を数十万回おこなう場合，１回のシミュレーションに時間がかかり，それをどのように高速化するかが問題になる。その際に役に立つパッケージが<code class="docutils literal notranslate"><span class="pre">Numba</span></code>であり，１行のコードを追加するだけで計算を驚く程高速化できる。しかし<code class="docutils literal notranslate"><span class="pre">Numba</span></code>には「相性」の問題がある。例えば，上の関数<code class="docutils literal notranslate"><span class="pre">my_sim()</span></code>で使った<code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>，<code class="docutils literal notranslate"><span class="pre">pandas</span></code>，<code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code>は<code class="docutils literal notranslate"><span class="pre">Numba</span></code>と相性が悪いが，<code class="docutils literal notranslate"><span class="pre">NumPy</span></code>は非常に相性が良い。また，<code class="docutils literal notranslate"><span class="pre">Numba</span></code>を使う際，リストよりも<code class="docutils literal notranslate"><span class="pre">array</span></code>を使う方が少しでも高速化を図ることができることも覚えておくと良いだろう。以下では，<code class="docutils literal notranslate"><span class="pre">Numba</span></code>を使う準備として，<code class="docutils literal notranslate"><span class="pre">NumPy</span></code>を使う「手計算」関数を考えることにする。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_sim_manual</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">b0</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">b1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">su</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>  <span class="c1"># nは標本の大きさ，　他はデフォルトを設定</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>   <span class="c1"># 以下を参照</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">su</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>  <span class="c1"># 以下を参照</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">b0</span> <span class="o">+</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">u</span>
    
    <span class="n">var_cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>   <span class="c1"># 分散共分散行列</span>
    <span class="n">cov_yx</span> <span class="o">=</span> <span class="n">var_cov</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>   <span class="c1"># 共分散</span>
    <span class="n">var_y</span> <span class="o">=</span> <span class="n">var_cov</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>    <span class="c1"># yの分散</span>
    <span class="n">var_x</span> <span class="o">=</span> <span class="n">var_cov</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>    <span class="c1"># xの分散        </span>
    <span class="n">avr_y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>        <span class="c1"># yの平均</span>
    <span class="n">avr_x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>        <span class="c1"># xの平均</span>
    
    <span class="n">b1hat</span> <span class="o">=</span> <span class="n">cov_yx</span> <span class="o">/</span> <span class="n">var_x</span>  <span class="c1"># スロープ係数の推定値</span>
    <span class="n">b0hat</span> <span class="o">=</span> <span class="n">avr_y</span> <span class="o">-</span> <span class="n">b1hat</span><span class="o">*</span><span class="n">avr_x</span>  <span class="c1"># 定数項の推定値</span>
    
    <span class="k">return</span> <span class="n">b0hat</span><span class="p">,</span> <span class="n">b1hat</span>     <span class="c1"># 推定値</span>
</pre></div>
</div>
</div>
</div>
<p>ここで使った<code class="docutils literal notranslate"><span class="pre">np.random.normal()</span></code>について簡単に説明する。<code class="docutils literal notranslate"><span class="pre">NumPy</span></code>にはランダム変数を生成する<code class="docutils literal notranslate"><span class="pre">random</span></code>というサブパッケージがあり，その中の<code class="docutils literal notranslate"><span class="pre">normal()</span></code>を使う。これは<code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code>の<code class="docutils literal notranslate"><span class="pre">norm.rvs()</span></code>と同じ引数を取り，同じ役割を果たす。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_sim_manual</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1.2812738939417012, 0.9473129317295875)
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">my_sim()</span></code>と<code class="docutils literal notranslate"><span class="pre">my_sim_manual()</span></code>の推定値が異なるのはランダム変数（<code class="docutils literal notranslate"><span class="pre">y</span></code>，<code class="docutils literal notranslate"><span class="pre">x</span></code>）の値が異なるためであり，それが推定誤差による影響である。</p>
</section>
<section id="id12">
<h3>ループを使ってシミュレーション<a class="headerlink" href="#id12" title="Permalink to this heading">#</a></h3>
<p>標本による推定は誤差が発生する。その誤差はどれだけ大きく（小さく）何に依存するかを確認するために<code class="docutils literal notranslate"><span class="pre">for</span></code>ループを使い次のシミュレーションを行うことにする。</p>
<ul class="simple">
<li><p>標本の大きさ<code class="docutils literal notranslate"><span class="pre">n</span></code>のデータを<code class="docutils literal notranslate"><span class="pre">N</span></code>組用意し（<code class="docutils literal notranslate"><span class="pre">N</span></code>は標本数），<code class="docutils literal notranslate"><span class="pre">OLS</span></code>推定を<code class="docutils literal notranslate"><span class="pre">N</span></code>回おこなう。</p></li>
<li><p>シミュレーション毎に計算した回帰係数の推定値の分布を図示する。</p></li>
</ul>
<p>まず<code class="docutils literal notranslate"><span class="pre">def</span></code>を使いシミュレーションの関数を作成するが，パラメータの推定値の計算には<code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>を使わずに，<code class="docutils literal notranslate"><span class="pre">numpy</span></code>の関数を使い「手計算」とする。これにより計算を高速化するパッケージ<code class="docutils literal notranslate"><span class="pre">Numba</span></code>を使うことが可能となる。使い方は簡単でデコレーターと呼ばれる<code class="docutils literal notranslate"><span class="pre">&#64;njit</span></code>（又は<code class="docutils literal notranslate"><span class="pre">&#64;jit</span></code>）を関数の上に加えるだけである。これだけで計算速度が数十倍早くなる場合もある。そのために、まず上で使った<code class="docutils literal notranslate"><span class="pre">my_sim_manual</span></code>に<code class="docutils literal notranslate"><span class="pre">&#64;njit</span></code>を加えて実行する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">my_sim_manual</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">b0</span><span class="p">,</span><span class="n">b1</span><span class="p">,</span><span class="n">su</span><span class="p">):</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">su</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">b0</span> <span class="o">+</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">u</span>
    
    <span class="n">var_cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
    <span class="n">cov_yx</span> <span class="o">=</span> <span class="n">var_cov</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">var_y</span> <span class="o">=</span> <span class="n">var_cov</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">var_x</span> <span class="o">=</span> <span class="n">var_cov</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">avr_y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">avr_x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    
    <span class="n">b1hat</span> <span class="o">=</span> <span class="n">cov_yx</span> <span class="o">/</span> <span class="n">var_x</span>
    <span class="n">b0hat</span> <span class="o">=</span> <span class="n">avr_y</span> <span class="o">-</span> <span class="n">b1hat</span><span class="o">*</span><span class="n">avr_x</span>
    
    <span class="k">return</span> <span class="n">b0hat</span><span class="p">,</span> <span class="n">b1hat</span>
</pre></div>
</div>
</div>
</div>
<p>この<code class="docutils literal notranslate"><span class="pre">my_sim_manual()</span></code>の内容は，上で作成した<code class="docutils literal notranslate"><span class="pre">my_sim_manual()</span></code>と全く同じである。単に<code class="docutils literal notranslate"><span class="pre">&#64;njit</span></code>の一行だけが付け加えられているだけだが，これにより全く別の高速化された関数に「変身」することになる。</p>
<p>次に<code class="docutils literal notranslate"><span class="pre">my_sim_manual()</span></code>を<code class="docutils literal notranslate"><span class="pre">for</span></code>ループで計算するシミュレーション用の関数を用意する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">my_sim_loop</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">b0</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">b1</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">su</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>  <span class="c1"># nとN以外はデフォルトを指定</span>
    
    <span class="n">b0hat_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>  <span class="c1"># OLS推定量を入れるarray（0がN個並んでいる）</span>
    <span class="n">b1hat_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>  <span class="c1"># OLS推定量を入れるarray（0がN個並んでいる）</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>  <span class="c1"># N 回のループ</span>
        
        <span class="c1"># 返り値が２つあるので、割り当てる場合には左辺の変数を &#39;,&#39; で区切る </span>
        <span class="n">b0hat</span><span class="p">,</span> <span class="n">b1hat</span> <span class="o">=</span> <span class="n">my_sim_manual</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">b0</span><span class="o">=</span><span class="n">b0</span><span class="p">,</span><span class="n">b1</span><span class="o">=</span><span class="n">b1</span><span class="p">,</span><span class="n">su</span><span class="o">=</span><span class="n">su</span><span class="p">)</span>

        <span class="n">b0hat_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b0hat</span>  <span class="c1"># i番目に定数項の推定値をarrに追加</span>
        <span class="n">b1hat_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b1hat</span>  <span class="c1"># i番目にスロープ係数の推定値をarrに追加</span>
        
    <span class="k">return</span> <span class="n">b0hat_arr</span><span class="p">,</span> <span class="n">b1hat_arr</span>  <span class="c1"># N回ループ終了後にarrayをタプルとして返すオブジェクト</span>
</pre></div>
</div>
</div>
</div>
<p>標本の大きさを<code class="docutils literal notranslate"><span class="pre">50</span></code>，シミュレーションの回数を<code class="docutils literal notranslate"><span class="pre">100_000</span></code>としてシミュレーションを始める。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">b0hat</span><span class="p">,</span> <span class="n">b1hat</span> <span class="o">=</span> <span class="n">my_sim_loop</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">N</span><span class="o">=</span><span class="mi">100_000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>初めて<code class="docutils literal notranslate"><span class="pre">my_sim_loop()</span></code>を実行すると<code class="docutils literal notranslate"><span class="pre">Numba</span></code>はコンパイルと呼ばれる高速化準備プロセスを経るため，<code class="docutils literal notranslate"><span class="pre">&#64;njit</span></code>がない場合と比べて実行スピードは早くない。２回目の実行から<code class="docutils literal notranslate"><span class="pre">Numba</span></code>の効果がフルに発揮されることになる。</p>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p><code class="docutils literal notranslate"><span class="pre">Python</span></code>の<code class="docutils literal notranslate"><span class="pre">for</span></code>ループはコンパイル言語（例えば，<code class="docutils literal notranslate"><span class="pre">C</span></code>）と比べると実行速度が遅い。それを少しでも克服しようというのが<code class="docutils literal notranslate"><span class="pre">Numba</span></code>である。一方，<code class="docutils literal notranslate"><span class="pre">for</span></code>ループ自体を使わずに<code class="docutils literal notranslate"><span class="pre">Numpy</span></code>の特徴であるベクトル演算を使うと格段に実行速度が速くなる。例えば，<code class="docutils literal notranslate"><span class="pre">my_sim_loop</span></code>の代わりに次の関数を試してみよう。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_sim_vectorize</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">b0</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">b1</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">su</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    
    <span class="c1"># 一度に全てのランダム変数を生成し，(n,N)のarrayに変換する</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">N</span><span class="p">))</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">su</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">N</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">b0</span> <span class="o">+</span> <span class="n">b1</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">u</span>

    <span class="c1"># 平均の計算</span>
    <span class="n">x_mean</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">y_mean</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># 分散の計算</span>
    <span class="n">x_var</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">y_var</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># 平均からの乖離を計算</span>
    <span class="n">x_mean_dev</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x_mean</span>
    <span class="n">y_mean_dev</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y_mean</span>

    <span class="c1"># 共分散の計算</span>
    <span class="n">yx_dev</span> <span class="o">=</span> <span class="n">y_mean_dev</span> <span class="o">*</span> <span class="n">x_mean_dev</span>
    <span class="n">yx_cov</span> <span class="o">=</span> <span class="n">yx_dev</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="c1"># 推定値の計算</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="n">yx_cov</span> <span class="o">/</span> <span class="n">x_var</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="n">y_mean</span> <span class="o">-</span> <span class="n">b1</span><span class="o">*</span><span class="n">x_mean</span>
    
    <span class="k">return</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span>
</pre></div>
</div>
<p>この関数には<code class="docutils literal notranslate"><span class="pre">for</span></code>ループはなく，戻り値<code class="docutils literal notranslate"><span class="pre">b0</span></code>と<code class="docutils literal notranslate"><span class="pre">b1</span></code>は<code class="docutils literal notranslate"><span class="pre">N</span></code>個の要素からなる推定値のarrayとなる。実行速度を比べるために次の２つのコードを別々のコードセルで実行してみよう。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">timeit</span> <span class="n">my_sim_loop</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">N</span><span class="o">=</span><span class="mi">1_000_000</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">timeit</span> <span class="n">my_sim_vectorize</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">N</span><span class="o">=</span><span class="mi">1_000_000</span><span class="p">)</span>
</pre></div>
</div>
<p>ここで<code class="docutils literal notranslate"><span class="pre">%timeit</span></code>は実行速度を測るマジック・コマンドと呼ばれるコードである。<code class="docutils literal notranslate"><span class="pre">my_sim_vectorize</span></code>が２倍近く速くなることが確認できるだろう。<code class="docutils literal notranslate"><span class="pre">Numba</span></code>のようなパッケージを導入しなくても，ベクトル演算を使う方が計算の時間を短縮できることを覚えておこう。</p>
</div>
<p><span class="math notranslate nohighlight">\(\hat{\beta}_0\)</span>の分布を図示する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">b0hat</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8b96de094b693088f0482ffefdc047614c4c810714db44b0b50720efad43f9fd.png" src="_images/8b96de094b693088f0482ffefdc047614c4c810714db44b0b50720efad43f9fd.png" />
</div>
</div>
<p><span class="math notranslate nohighlight">\(\hat{\beta}_1\)</span>の分布を図示する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">b1hat</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/78aba2663d69cde01ff0c18bc5b565a2bcd0d923459b74bb63becbc58fd899ae.png" src="_images/78aba2663d69cde01ff0c18bc5b565a2bcd0d923459b74bb63becbc58fd899ae.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">y</span></code>の理論値を図示するが，図示の時間短縮のために<code class="docutils literal notranslate"><span class="pre">N</span></code>回のシミュレーション中の最初の<code class="docutils literal notranslate"><span class="pre">r</span></code>回の回帰線だけを表示する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="mi">1000</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">r</span></code>回の回帰線を<code class="docutils literal notranslate"><span class="pre">for</span></code>ループを使って重ねて図示してみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>  <span class="c1"># r回のループで図示</span>
    <span class="n">yhat</span> <span class="o">=</span> <span class="n">b0hat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">b1hat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">xx</span>  <span class="c1"># yの予測値</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yhat</span><span class="p">,</span> <span class="s1">&#39;grey&#39;</span><span class="p">)</span>  <span class="c1"># yの予測値を図示</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># 縦軸の表示範囲を設定</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s1"> rounds of OLS simulation&#39;</span><span class="p">)</span>
<span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ac7c8841e6a2ba38a19032a191d36209cde350629a362381d5f87f6d5c782da6.png" src="_images/ac7c8841e6a2ba38a19032a191d36209cde350629a362381d5f87f6d5c782da6.png" />
</div>
</div>
<div class="admonition- admonition">
<p class="admonition-title">コードの説明</p>
<p>上のコード・ブロックの最後から２行目に<code class="docutils literal notranslate"><span class="pre">f'{r}</span> <span class="pre">rounds</span> <span class="pre">of</span> <span class="pre">OLS</span> <span class="pre">simulation'</span></code>とある。文字列の前に<code class="docutils literal notranslate"><span class="pre">f</span></code>を置き、文字列の中で上で定義した変数を<code class="docutils literal notranslate"><span class="pre">{}</span></code>で囲むとその変数の値を代入することができる。これを<code class="docutils literal notranslate"><span class="pre">f-string</span></code>と呼ぶ。</p>
</div>
<hr class="docutils" />
<p><strong>＜シミュレーションの含意＞</strong></p>
<p>まず上の２つのヒストグラムをみると，値にばらつきがある。これは推定量（<span class="math notranslate nohighlight">\(\hat{\beta}_0\)</span>と<span class="math notranslate nohighlight">\(\hat{\beta}_1\)</span>）が確率変数であるためである。その実現値は，真の値（<span class="math notranslate nohighlight">\(\beta_0=1.0\)</span>と<span class="math notranslate nohighlight">\(\beta_1=1.0\)</span>）を中心に左右対象に分布している。即ち，推定量は不偏性を満たしている。次の章で簡単に説明するが，上で行ったシミュレーションは不偏推定量に必要な仮定を満たしているためである。</p>
<p>これを踏まえて，回帰直線の図を考えよう。同じ回帰式を使い<code class="docutils literal notranslate"><span class="pre">N</span></code>回のシミュレーションを行った後，最初の<code class="docutils literal notranslate"><span class="pre">r</span></code>個の回帰直線を重ねて描いているためパイプのような形になっている。一方で，実際の実証分析ではこのような繰り返しの試行は不可能であり多くの場合は一度だけである。言い換えると，実証研究では<code class="docutils literal notranslate"><span class="pre">N</span></code>個の回帰直線の中から１つだけを結果として「ランダムに選んでいる」のと等しい。この意味を更に考えるために，（標本の大きさは所与として）たまたま２組みのデータセットが手に入り，別々の回帰分析を行ったとしよう。その場合，パイプの幅が広ければ広いほど，２つの回帰直線の位置は大きく異なる可能性が高くなり，正確性が低い結果になる。逆に，パイプの幅が狭ければ狭いほど，２つの結果は似たものになり，より正確な推定結果となる。このように実証分析ではパイプの幅が可能な限り小さくなる工夫が必要になる。その１つが標本の大きさ<code class="docutils literal notranslate"><span class="pre">n</span></code>である。<code class="docutils literal notranslate"><span class="pre">n</span></code>が増えるとパイプは細くなり，極限<span class="math notranslate nohighlight">\(n\rightarrow\infty\)</span>（即ち，標本の大きさと母集団の大きさの差が限りなくゼロに近づく）ではパイプの形が直線（母集団回帰式）に近づくことになる。このように，実証分析において標本の大きさは非常に重要な役割を果たすことになる。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<ul class="simple">
<li><p>このシミュレーションの場合，推定量の<strong>一致性</strong>が満たされているため，パイプが母集団回帰式に収束することになる。しかし一般的に必ずそうなるとは限らない。ある仮定のもとでのみ推定量は一致性を満たすことになる。</p></li>
<li><p>推定方法によっては，不偏性は満たさないが一致性を満たす推定量も存在する。また，エギゾチックな例になるがその逆もあり得る。</p></li>
</ul>
</div>
<p>—– Give it a try! —–</p>
<p>標本の大きさ<code class="docutils literal notranslate"><span class="pre">n</span></code>を変えて試してみよう。例えば，10, 30, 100, 500, 1000。</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="list_of_terms.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">計量経済学用語</p>
      </div>
    </a>
    <a class="right-next"
       href="9_Multiple_Regression.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">重回帰分析</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">説明</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">データ</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">「手計算」</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#statsmodels"><code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>を使う</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">図</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">モデルの適合度</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">賃金の対数化</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ols">シミュレーション：<span class="math notranslate nohighlight">\(OLS\)</span>推定</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">母集団の考え方</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">プラン</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">シミュレーション</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">関数化</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">ループを使ってシミュレーション</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By 春山 鉄源  Tetsugen HARUYAMA
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2020-2023（公開開始日：2020年5月4日）.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <!-- Default Statcounter code for Py4etrics https://py4etrics.github.io/ --> <script type="text/javascript"> var sc_project=12340470; var sc_invisible=1; var sc_security="72befddb"; </script> <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async></script> <noscript><div class="statcounter"><a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img class="statcounter" src="https://c.statcounter.com/12340470/0/72befddb/1/" alt="Web Analytics"></a></div></noscript> <!-- End of Statcounter Code -->
</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=ac02cc09edc035673794"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>