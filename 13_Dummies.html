

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>質的変数と回帰分析 &#8212; Pythonで学ぶ入門計量経済学</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/mystnb.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="canonical" href="https://spring-book.github.io/book_etrics/13_Dummies.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="不均一分散" href="14_Heteroskedasticity.html" />
    <link rel="prev" title="大標本特性" href="12_Asymptotics.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">


<!-- Opengraph tags -->
<meta property="og:url"         content="https://spring-book.github.io/book_etrics/13_Dummies.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="質的変数と回帰分析" />
<meta property="og:description" content="質的変数と回帰分析  import numpy as np import pandas as pd from statsmodels.formula.api import ols import wooldridge  実証分析で使う変数を次の２種類に区別することができる。  量的変数（体重，賃金など）  質的変数（性別" />


<meta name="twitter:card" content="summary">


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  
  <h1 class="site-logo" id="site-title">Pythonで学ぶ入門計量経済学</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  <ul class="nav sidenav_l1">
  <li class="">
    <a href="part_1.html">１. Pythonの基礎</a>
  </li>
  <li class="active">
    <a href="part_2.html">２. Pythonを使った計量経済分析</a>
  <ul class="nav sidenav_l2">
    <li class="">
      <a href="7_Review_of_Statistics.html">統計学の簡単な復習</a>
    </li>
    <li class="">
      <a href="8_Simple_Regression.html">単回帰分析</a>
    </li>
    <li class="">
      <a href="9_Multiple_Regression.html">重回帰分析</a>
    </li>
    <li class="">
      <a href="10_Residuals.html">残差診断</a>
    </li>
    <li class="">
      <a href="11_Inference.html">推論</a>
    </li>
    <li class="">
      <a href="12_Asymptotics.html">大標本特性</a>
    </li>
    <li class="active">
      <a href="">質的変数と回帰分析</a>
    </li>
    <li class="">
      <a href="14_Heteroskedasticity.html">不均一分散</a>
    </li>
    <li class="">
      <a href="15_Pooling.html">プーリング・データとパネル・データ</a>
    </li>
    <li class="">
      <a href="16_linearmodels.html">linearmodels</a>
    </li>
    <li class="">
      <a href="17_Panel.html">パネル・データ分析</a>
    </li>
    <li class="">
      <a href="18_Zero_Conditional_Mean.html">GM仮定４が満たされない場合</a>
    </li>
    <li class="">
      <a href="19_IV2SLS.html">操作変数法と２段階OLS</a>
    </li>
    <li class="">
      <a href="20_LogitProbit.html">離散選択モデル</a>
    </li>
    <li class="">
      <a href="21_TruncregTobitHeckit.html">制限従属変数モデル</a>
    </li>
  </ul>
  </li>
  <li class="">
    <a href="part_3.html">３. 番外編</a>
  </li>
</ul>
</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  <a  href="https://github.com/spring-book/py4etrics">&#128200;&#127891;&#128202;</a><!-- Default Statcounter code for Py4etrics https://spring-book.github.io/py4etrics/ --> <script type="text/javascript"> var sc_project=12339954; var sc_invisible=1; var sc_security="45ab8946"; </script> <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async></script> <noscript><div class="statcounter"><a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img class="statcounter" src="https://c.statcounter.com/12339954/0/45ab8946/1/" alt="Web Analytics"></a></div></noscript> <!-- End of Statcounter Code -->
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse" data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu" aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation" title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i class="fas fa-download"></i></button>

            
            <div class="dropdown-buttons">
                <!-- ipynb file if we had a myst markdown file -->
                
                <!-- Download raw file -->
                <a class="dropdown-buttons" href="_sources/13_Dummies.ipynb"><button type="button" class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip" data-placement="left">.ipynb</button></a>
                <!-- Download PDF via print -->
                <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF" onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
            </div>
            
        </div>

        <!-- Source interaction buttons -->
        

        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->
        
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
            <div class="dropdown-buttons">
                
                <a class="binder-button" href="https://mybinder.org/v2/gh/spring-book/py4etrics/master?urlpath=tree/13_Dummies.ipynb"><button type="button" class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip" data-placement="left"><img class="binder-button-logo" src="_static/images/logo_binder.svg" alt="Interact on binder">Binder</button></a>
                
                
                
            </div>
        </div>
        
    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#id2" class="nav-link">ダミー変数</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#id3" class="nav-link">ケース１：定数項だけの回帰分析</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h4">
            <a href="#id4" class="nav-link">ダミー変数なし</a>
        </li>
    
        <li class="nav-item toc-entry toc-h4">
            <a href="#id5" class="nav-link">ダミー変数あり：２つのケース</a>
        </li>
    
        <li class="nav-item toc-entry toc-h4">
            <a href="#id6" class="nav-link">ダミー変数あり：４つのケース</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#id7" class="nav-link">ケース２：定量的変数の導入</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#id8" class="nav-link">ケース３：ダミー変数の交差項</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#id9" class="nav-link">カテゴリー変数</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#c" class="nav-link">C()を使う方法</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h4">
            <a href="#id10" class="nav-link">例１</a>
        </li>
    
        <li class="nav-item toc-entry toc-h4">
            <a href="#id11" class="nav-link">例２</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#id12" class="nav-link">C()を使わない方法</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>


    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="id1">
<h1>質的変数と回帰分析<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">statsmodels.formula.api</span> <span class="kn">import</span> <span class="n">ols</span>
<span class="kn">import</span> <span class="nn">wooldridge</span>
</pre></div>
</div>
</div>
</div>
<p>実証分析で使う変数を次の２種類に区別することができる。</p>
<ol class="simple">
<li><p>量的変数（体重，賃金など）</p></li>
<li><p>質的変数（性別，人種，地域など）</p></li>
</ol>
<p>今までは量的変数を考えたが，ここでは質的変数について議論する。まず男女のような２つの属性に分けるダミー変数を考える。その後に，より一般的な3つ以上の属性をに特徴付けられるカテゴリー変数を扱う場合を説明する。</p>
<div class="section" id="id2">
<h2>ダミー変数<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id3">
<h3>ケース１：定数項だけの回帰分析<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id4">
<h4>ダミー変数なし<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>直感的な説明にするために説明変数が定数項だけの回帰分析から始める。
具体的には次の回帰式を考える。</p>
<p><span class="math notranslate nohighlight">\(y=\beta_0+u\)</span></p>
<p>実は，この場合のOLS推定量<span class="math notranslate nohighlight">\(\hat{\beta}_0\)</span>は被説明変数<span class="math notranslate nohighlight">\(y\)</span>の平均と等しいことになる。この結果を確認するために以下では<code class="docutils literal notranslate"><span class="pre">wooldridge</span></code>パッケージの<code class="docutils literal notranslate"><span class="pre">wage1</span></code>のデータを使う。</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wage1</span> <span class="o">=</span> <span class="n">wooldridge</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;wage1&#39;</span><span class="p">)</span>
<span class="n">wooldridge</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;wage1&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>name of dataset: wage1
no of variables: 24
no of observations: 526

+----------+---------------------------------+
| variable | label                           |
+----------+---------------------------------+
| wage     | average hourly earnings         |
| educ     | years of education              |
| exper    | years potential experience      |
| tenure   | years with current employer     |
| nonwhite | =1 if nonwhite                  |
| female   | =1 if female                    |
| married  | =1 if married                   |
| numdep   | number of dependents            |
| smsa     | =1 if live in SMSA              |
| northcen | =1 if live in north central U.S |
| south    | =1 if live in southern region   |
| west     | =1 if live in western region    |
| construc | =1 if work in construc. indus.  |
| ndurman  | =1 if in nondur. manuf. indus.  |
| trcommpu | =1 if in trans, commun, pub ut  |
| trade    | =1 if in wholesale or retail    |
| services | =1 if in services indus.        |
| profserv | =1 if in prof. serv. indus.     |
| profocc  | =1 if in profess. occupation    |
| clerocc  | =1 if in clerical occupation    |
| servocc  | =1 if in service occupation     |
| lwage    | log(wage)                       |
| expersq  | exper^2                         |
| tenursq  | tenure^2                        |
+----------+---------------------------------+

These are data from the 1976 Current Population Survey, collected by
Henry Farber when he and I were colleagues at MIT in 1988.
</pre></div>
</div>
</div>
</div>
<p>時間平均賃金<code class="docutils literal notranslate"><span class="pre">wage</span></code>を被説明変数に設定する。<code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>では，定数項だけの回帰式を考える場合，<code class="docutils literal notranslate"><span class="pre">1</span></code>をつか加える必要がある。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">form_const</span> <span class="o">=</span> <span class="s1">&#39;wage ~ 1&#39;</span>  <span class="c1"># 定数項だけの場合は１が必要</span>

<span class="n">res_const</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">form_const</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">wage1</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">res_const</span><span class="o">.</span><span class="n">params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>Intercept    5.896103
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>この推定値が賃金の平均と等しいこをを確認するために，直接平均を計算する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wage1</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;wage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>5.896102674787035
</pre></div>
</div>
</div>
</div>
<p>この結果はGM仮定4の<span class="math notranslate nohighlight">\(\text{E}(u|X)=0\)</span>から簡単に導出できる。この仮定を標本回帰式で考えると次式となる。</p>
<div class="math notranslate nohighlight">
\[\frac{1}{N}\sum_{i=1}^Nu_i=0\]</div>
<p>この式の左辺にに回帰式を代入すると</p>
<div class="math notranslate nohighlight">
\[\frac{1}{N}\sum_{i=1}^N\left( y_i-\beta_0\right)=\bar{y}-\beta_0\]</div>
<p>この式が0となる<span class="math notranslate nohighlight">\(\hat{\beta_0}\)</span>がOLS推定量なので</p>
<div class="math notranslate nohighlight">
\[\bar{y}=\hat{\beta_0}\]</div>
<p>となる。</p>
</div>
<div class="section" id="id5">
<h4>ダミー変数あり：２つのケース<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>同じデータを使って<span class="math notranslate nohighlight">\(\{0,1\}\)</span>の値を取るダミー変数を考える。データセット<code class="docutils literal notranslate"><span class="pre">wage1</span></code>の中の<code class="docutils literal notranslate"><span class="pre">female</span></code>という変数があり，以下の値を取る。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>女性の場合：female = 1
男性の場合：female = 0
</pre></div>
</div>
<p>値が０のカテゴリーを<strong>基本カテゴリー</strong>という。</p>
<p><span class="math notranslate nohighlight">\(D\)</span>を<code class="docutils literal notranslate"><span class="pre">female</span></code>のダミー変数とすると回帰式は以下のようになる。</p>
<div class="math notranslate nohighlight">
\[
y=\beta_0+\beta_1D
\]</div>
<p>さらに，この式は<span class="math notranslate nohighlight">\(D=\{0,1\}\)</span>の値によって以下のように表すことができる。</p>
<p>男性：<span class="math notranslate nohighlight">\(D=0\quad\Rightarrow\quad y=\beta_0+u\)</span></p>
<p>女性：<span class="math notranslate nohighlight">\(D=1\quad\Rightarrow\quad y=\beta_0+\beta_1+u\)</span></p>
<p>即ち，OLS推定量は以下を表すことになる。</p>
<p><span class="math notranslate nohighlight">\(\hat{\beta}_0\)</span>：男性の平均賃金</p>
<p><span class="math notranslate nohighlight">\(\hat{\beta}_0+\hat{\beta}_1\)</span>：女性の平均賃金</p>
<p>この回帰式を使い，時間賃金の男女間の差について考察する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">form_const_2</span> <span class="o">=</span> <span class="s1">&#39;wage ~ female&#39;</span>

<span class="n">res_const_2</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">form_const_2</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">wage1</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">res_const_2</span><span class="o">.</span><span class="n">params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>Intercept    7.099489
female      -2.511830
dtype: float64
</pre></div>
</div>
</div>
</div>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">female=0</span></code>の場合は男性なので，定数項の値（約7.10）が男性の時間賃金の平均である。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">female=1</span></code>の場合は女性なので，女性の時間賃金の平均は</p>
<div class="math notranslate nohighlight">
\[7.10-2.51\approx 4.59\]</div>
</li>
</ul>
<p>即ち，男性（基本カテゴリー）と比べて女性の平均賃金は2.51ドル低い。</p>
<p>データを使い直接男女の平均を計算して確認する。</p>
<p>＜女性の場合＞</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 女性だけを抽出するTrue/False条件の作成</span>
<span class="n">cond_female</span> <span class="o">=</span> <span class="p">(</span><span class="n">wage1</span><span class="p">[</span><span class="s1">&#39;female&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>

<span class="n">wage1</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond_female</span><span class="p">,</span><span class="s1">&#39;wage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>4.587658740225292
</pre></div>
</div>
</div>
</div>
<p>＜男性の場合＞</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 男性だけを抽出するTrue/False条件の作成</span>
<span class="n">cond_male</span> <span class="o">=</span> <span class="p">(</span><span class="n">wage1</span><span class="p">[</span><span class="s1">&#39;female&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>

<span class="n">wage1</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond_male</span><span class="p">,</span><span class="s1">&#39;wage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>7.099489067157689
</pre></div>
</div>
</div>
</div>
<p><strong>（解釈）</strong></p>
<ul class="simple">
<li><p>女性の時間賃金は約2.51ドル低い</p></li>
<li><p>しかし比較する場合，同じ条件で比べるべきではないだろうか。例えば，未婚・既婚，教育年数や就労期間が賃金に影響する場合，この差を考慮すべきである。しかし，この回帰式にはそのような変数は含まれていないため，含まれていない変数の違いが賃金の違いに反映されている可能性が高い。</p></li>
</ul>
</div>
<div class="section" id="id6">
<h4>ダミー変数あり：４つのケース<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>データセット<code class="docutils literal notranslate"><span class="pre">wage1</span></code>には<code class="docutils literal notranslate"><span class="pre">married</span></code>という変数が含まれており，以下の値をとる。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>既婚者の場合：married = 1
未婚者の場合：married = 0
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">female</span></code>と組み合わせることにより，次の４つのケースを分けることができる。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>未婚男性：female=0, married=0
未婚女性：female=1, married=0
既婚女性：female=1, married=1
既婚男性：female=0, married=1
</pre></div>
</div>
<p>この４つのケースを捉えるために、<code class="docutils literal notranslate"><span class="pre">female</span></code>と<code class="docutils literal notranslate"><span class="pre">married</span></code>の値によって<code class="docutils literal notranslate"><span class="pre">0</span></code>もしくは<code class="docutils literal notranslate"><span class="pre">1</span></code>の値になるダミー変数を作成する。</p>
<hr class="docutils" />
<p>＜ステップ１＞</p>
<p>新たなダミー変数の作成ルールを定義する関数を作成する。この関数では<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>の行を引数とする。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 以下では row をDataFrameの行と考える。</span>

<span class="c1"># 未婚男性の関数</span>
<span class="k">def</span> <span class="nf">singmale</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;female&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;married&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

<span class="c1"># 既婚男性の関数</span>
<span class="k">def</span> <span class="nf">marmale</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;female&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;married&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

<span class="c1"># 未婚女性の関数</span>
<span class="k">def</span> <span class="nf">singfem</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;female&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;married&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

<span class="c1"># 既婚女性の関数</span>
<span class="k">def</span> <span class="nf">marfem</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;female&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;married&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<p>＜ステップ２＞</p>
<p>上の関数を使い，<code class="docutils literal notranslate"><span class="pre">wage1</span></code>に新たな列を追加する。</p>
<p>以下のコードで使う<code class="docutils literal notranslate"><span class="pre">.apply()</span></code>は第１引数の関数を行または列に適用するメソッドである。<code class="docutils literal notranslate"><span class="pre">axis=1</span></code>は「任意の列に沿って各行に関数を適用する」ことを指定している（<code class="docutils literal notranslate"><span class="pre">axis='columns'</span></code>でもOK）。また、引数の関数に<code class="docutils literal notranslate"><span class="pre">()</span></code>は書かないことに注意しよう。即ち，引数に関数名（関数を参照する「参照記号」）を引数とすることにより，関数のオブジェクトを参照していることになる。即ち、<code class="docutils literal notranslate"><span class="pre">.apply()</span></code>は第１引数の関数を参照し、それを実行するメソッドである。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wage1</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;singmale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wage1</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">singmale</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">wage1</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;marmale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wage1</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">marmale</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">wage1</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;singfem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wage1</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">singfem</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
<span class="n">wage1</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;marfem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wage1</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">marfem</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>

<span class="n">wage1</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wage</th>
      <th>educ</th>
      <th>exper</th>
      <th>tenure</th>
      <th>nonwhite</th>
      <th>female</th>
      <th>married</th>
      <th>numdep</th>
      <th>smsa</th>
      <th>northcen</th>
      <th>...</th>
      <th>profocc</th>
      <th>clerocc</th>
      <th>servocc</th>
      <th>lwage</th>
      <th>expersq</th>
      <th>tenursq</th>
      <th>singmale</th>
      <th>marmale</th>
      <th>singfem</th>
      <th>marfem</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3.10</td>
      <td>11</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.131402</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3.24</td>
      <td>12</td>
      <td>22</td>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1.175573</td>
      <td>484</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.00</td>
      <td>11</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.098612</td>
      <td>4</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 28 columns</p>
</div></div></div>
</div>
<p>一方でコードを書く際、似たものをコピペして少しだけ変更することを繰り返すとエラーや意図しない結果につながる可能性が高くなる。その場合は、次のように<code class="docutils literal notranslate"><span class="pre">for</span></code>ループで書くことを薦める。</p>
<p>まず辞書を作成する：</p>
<ul class="simple">
<li><p>キーを列のラベル</p></li>
<li><p>値を関数名</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;singmale&#39;</span><span class="p">:</span><span class="n">singmale</span><span class="p">,</span>
             <span class="s1">&#39;marmale&#39;</span><span class="p">:</span><span class="n">marmale</span><span class="p">,</span>
             <span class="s1">&#39;singfem&#39;</span><span class="p">:</span><span class="n">singfem</span><span class="p">,</span>
             <span class="s1">&#39;marfem&#39;</span><span class="p">:</span><span class="n">marfem</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>次に<code class="docutils literal notranslate"><span class="pre">func_dict</span></code>を使い<code class="docutils literal notranslate"><span class="pre">for</span></code>ループで列を追加する。ここで<code class="docutils literal notranslate"><span class="pre">key</span></code>は辞書のキーを指す。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">func_dict</span><span class="p">:</span>
    <span class="n">wage1</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">wage1</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">func_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">wage1</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wage</th>
      <th>educ</th>
      <th>exper</th>
      <th>tenure</th>
      <th>nonwhite</th>
      <th>female</th>
      <th>married</th>
      <th>numdep</th>
      <th>smsa</th>
      <th>northcen</th>
      <th>...</th>
      <th>profocc</th>
      <th>clerocc</th>
      <th>servocc</th>
      <th>lwage</th>
      <th>expersq</th>
      <th>tenursq</th>
      <th>singmale</th>
      <th>marmale</th>
      <th>singfem</th>
      <th>marfem</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3.10</td>
      <td>11</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.131402</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3.24</td>
      <td>12</td>
      <td>22</td>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1.175573</td>
      <td>484</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.00</td>
      <td>11</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.098612</td>
      <td>4</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 28 columns</p>
</div></div></div>
</div>
<hr class="docutils" />
<p>これら４つのケースを捉えるために次の回帰式を使う。</p>
<p><span class="math notranslate nohighlight">\(y=\beta_0+\beta_1D_1+\beta_2D_2+\beta_3D_3+u\)</span></p>
<ul class="simple">
<li><p>基本カテゴリー：<code class="docutils literal notranslate"><span class="pre">singmale</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(D_1\)</span>=<code class="docutils literal notranslate"><span class="pre">marmale</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(D_2\)</span>=<code class="docutils literal notranslate"><span class="pre">singfem</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(D_3\)</span>=<code class="docutils literal notranslate"><span class="pre">marfem</span></code></p></li>
</ul>
<hr class="docutils" />
<p><span class="math notranslate nohighlight">\(D_1=\{0,1\}\)</span>、<span class="math notranslate nohighlight">\(D_2=\{0,1\}\)</span>、<span class="math notranslate nohighlight">\(D_3=\{0,1\}\)</span>の取る値を考慮すると，以下の４つのパターンに分けることができる。</p>
<p><span class="math notranslate nohighlight">\(D_1=0\)</span> &amp; <span class="math notranslate nohighlight">\(D_2=0\)</span> &amp; <span class="math notranslate nohighlight">\(D_3=0\quad\Rightarrow\quad\)</span>
<span class="math notranslate nohighlight">\(y=\beta_0+u\)</span></p>
<p><span class="math notranslate nohighlight">\(D_1=1\)</span> &amp; <span class="math notranslate nohighlight">\(D_2=0\)</span> &amp; <span class="math notranslate nohighlight">\(D_3=0\quad\Rightarrow\quad\)</span>
<span class="math notranslate nohighlight">\(y=\beta_0+\beta_1+u\)</span></p>
<p><span class="math notranslate nohighlight">\(D_1=0\)</span> &amp; <span class="math notranslate nohighlight">\(D_2=1\)</span> &amp; <span class="math notranslate nohighlight">\(D_3=0\quad\Rightarrow\quad\)</span>
<span class="math notranslate nohighlight">\(y=\beta_0+\beta_2+u\)</span></p>
<p><span class="math notranslate nohighlight">\(D_1=0\)</span> &amp; <span class="math notranslate nohighlight">\(D_2=0\)</span> &amp; <span class="math notranslate nohighlight">\(D_3=1\quad\Rightarrow\quad\)</span>
<span class="math notranslate nohighlight">\(y=\beta_0+\beta_3+u\)</span></p>
<p>即ち，OLS推定量は以下を表すことになる。</p>
<p><span class="math notranslate nohighlight">\(\hat{\beta}_0\)</span>：未婚男性の平均賃金</p>
<p><span class="math notranslate nohighlight">\(\hat{\beta}_0+\hat{\beta}_1\)</span>：既婚男性の平均賃金</p>
<p><span class="math notranslate nohighlight">\(\hat{\beta}_0+\hat{\beta}_2\)</span>：未婚女性の平均賃金</p>
<p><span class="math notranslate nohighlight">\(\hat{\beta}_0+\hat{\beta}_3\)</span>：既婚女性の平均賃金</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">form_const_4</span> <span class="o">=</span> <span class="s1">&#39;wage ~ marmale + singfem + marfem&#39;</span>

<span class="n">res_const_4</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">form_const_4</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">wage1</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">para4</span> <span class="o">=</span> <span class="n">res_const_4</span><span class="o">.</span><span class="n">params</span>
<span class="n">para4</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>Intercept    5.168023
marmale      2.815009
singfem     -0.556440
marfem      -0.602114
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>（結果）</p>
<ul class="simple">
<li><p>未婚男性の平均賃金は約5.16</p></li>
<li><p>未婚男性に比べて既婚男性の平均賃金は約2.82高い</p></li>
<li><p>未婚男性に比べて未婚女性の平均賃金は約0.56低い</p></li>
<li><p>未婚男性に比べて既婚女性の平均賃金は約0.60低い</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">wage1</span></code>のデータから直接計算して確認する。</p>
<p>未婚男性の平均賃金</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wage1</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;female==0 &amp; married==0&#39;</span><span class="p">)[</span><span class="s1">&#39;wage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>5.168023282705351
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">para4</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>5.168023282705353
</pre></div>
</div>
</div>
</div>
<p>既婚男性の平均賃金</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wage1</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;female==0 &amp; married==1&#39;</span><span class="p">)[</span><span class="s1">&#39;wage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>7.983031926002909
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">para4</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">para4</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>7.983031926002912
</pre></div>
</div>
</div>
</div>
<p>未婚女性の平均賃金</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wage1</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;female==1 &amp; married==0&#39;</span><span class="p">)[</span><span class="s1">&#39;wage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>4.611583345135053
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">para4</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">para4</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>4.611583345135056
</pre></div>
</div>
</div>
</div>
<p>既婚女性の平均賃金</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wage1</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;female==1 &amp; married==1&#39;</span><span class="p">)[</span><span class="s1">&#39;wage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>4.565909099398238
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">para4</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">para4</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>4.5659090993982385
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="id7">
<h3>ケース２：定量的変数の導入<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>１つのダミー変数<code class="docutils literal notranslate"><span class="pre">female</span></code>だけが入るケースに次の変数を加えた回帰式を考える。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">educ</span></code>：教育年数</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">exper</span></code>：雇用経験年数</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tenure</span></code>：勤続年数</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">form_1</span> <span class="o">=</span> <span class="s1">&#39;wage ~ female + educ + exper+ tenure&#39;</span>

<span class="n">res_1</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">form_1</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">wage1</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">res_1</span><span class="o">.</span><span class="n">params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>Intercept   -1.567939
female      -1.810852
educ         0.571505
exper        0.025396
tenure       0.141005
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>（解釈）</p>
<ul class="simple">
<li><p>賃金格差は約-1.81に減少した。これは<code class="docutils literal notranslate"><span class="pre">educ</span></code>, <code class="docutils literal notranslate"><span class="pre">exper</span></code>, <code class="docutils literal notranslate"><span class="pre">tenure</span></code>の影響を取り除いた結果である。言い換えると，教育，経験，就労期間を所与とすると（それらの変数が同じである場合という意味），女性の時間賃金は約1.8ドル低い。</p></li>
<li><p>女性差別を捉えているのだろうか？回帰式にない変数（その影響は誤差項に入っている）が残っている可能性があるので，必ずしもそうではない。またその場合，欠落変数バイアスも発生し得る。</p></li>
</ul>
</div>
<div class="section" id="id8">
<h3>ケース３：ダミー変数の交差項<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>ケース１と２の被説明変数は<code class="docutils literal notranslate"><span class="pre">wage</span></code>をそのまま使ったが，ここでは対数を取り賃金方程式にダミー変数の交差項を入れて考察する。</p>
<p>以下の回帰式を考える。</p>
<div class="math notranslate nohighlight">
\[y=\beta_0+\beta_1D+ \beta_2Dx+\beta_3x + u\]</div>
<p>ここで<span class="math notranslate nohighlight">\(D\)</span>がダミー変数，<span class="math notranslate nohighlight">\(x=\)</span>は定量的変数であり，<span class="math notranslate nohighlight">\(Dx\)</span>がダミー変数の交差項である。ダミー変数が取る値<span class="math notranslate nohighlight">\(D=\{0,1\}\)</span>に分けて考えると，以下を推定することになる。</p>
<p><span class="math notranslate nohighlight">\(D=0\quad\Rightarrow\quad
y=\beta_0+\beta_3x + u\)</span></p>
<p><span class="math notranslate nohighlight">\(D=1\quad\Rightarrow\quad
y=\left(\beta_0+\beta_1\right)+ \left(\beta_2+\beta_3\right)x + u\)</span></p>
<hr class="docutils" />
<p>具体例として<span class="math notranslate nohighlight">\(D=\)</span>
<code class="docutils literal notranslate"><span class="pre">female</span></code>，<span class="math notranslate nohighlight">\(x=\)</span><code class="docutils literal notranslate"><span class="pre">educ</span></code>とするとOLS推定量は以下を表すことになる。</p>
<p><span class="math notranslate nohighlight">\(\hat{\beta}_0\)</span>：（教育の効果を取り除いた）男性の平均賃金（対数）</p>
<p><span class="math notranslate nohighlight">\(\hat{\beta}_3\)</span>：男性の賃金に対する教育の効果（％）</p>
<p><span class="math notranslate nohighlight">\(\hat{\beta}_0+\hat{\beta}_1\)</span>：（教育の効果を取り除いた）女性の平均賃金（対数）</p>
<p><span class="math notranslate nohighlight">\(\hat{\beta}_2+\hat{\beta}_3\)</span>：女性の賃金に対する教育の効果（％）</p>
<p>（注意）</p>
<p><code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>の回帰式では<span class="math notranslate nohighlight">\(\text{female}\times \text{educ}\)</span>を<span class="math notranslate nohighlight">\(\text{female}:\text{educ}\)</span>と書く。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">form_2</span> <span class="o">=</span> <span class="s1">&#39;np.log(wage) ~ female + female:educ + educ + exper + tenure&#39;</span>

<span class="n">res_2</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">form_2</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">wage1</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">res_2</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>===============================================================================
                  coef    std err          t      P&gt;|t|      [0.025      0.975]
-------------------------------------------------------------------------------
Intercept       0.4647      0.123      3.781      0.000       0.223       0.706
female         -0.2104      0.174     -1.209      0.227      -0.552       0.131
female:educ    -0.0072      0.014     -0.534      0.593      -0.034       0.019
educ            0.0903      0.009     10.359      0.000       0.073       0.107
exper           0.0046      0.002      2.850      0.005       0.001       0.008
tenure          0.0174      0.003      5.849      0.000       0.012       0.023
===============================================================================
</pre></div>
</div>
</div>
</div>
<p><strong><span class="math notranslate nohighlight">\(t\)</span>検定</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">female</span></code></p>
<ul>
<li><p>教育などの影響を省いた後の平均賃金の差</p></li>
<li><p>5%有意水準で<span class="math notranslate nohighlight">\(\text{H}_0\)</span><code class="docutils literal notranslate"><span class="pre">female</span></code>=0は棄却できない。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">female:educ</span></code></p>
<ul>
<li><p>教育などの影響を省いた後の教育の収益率の差</p></li>
<li><p>5%有意水準で<span class="math notranslate nohighlight">\(\text{H}_0\)</span>
<code class="docutils literal notranslate"><span class="pre">female:educ</span></code>=0は棄却できない。</p></li>
</ul>
</li>
</ul>
<p><strong><span class="math notranslate nohighlight">\(F\)</span>検定</strong></p>
<p><span class="math notranslate nohighlight">\(\text{H}_0\)</span>: <code class="docutils literal notranslate"><span class="pre">female</span></code><span class="math notranslate nohighlight">\(=\)</span>
<code class="docutils literal notranslate"><span class="pre">female:educ</span></code><span class="math notranslate nohighlight">\(=0\)</span>の制約を考えよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hypotheses</span> <span class="o">=</span> <span class="s1">&#39;female=0, female:educ=0&#39;</span>

<span class="n">res_2</span><span class="o">.</span><span class="n">f_test</span><span class="p">(</span><span class="n">hypotheses</span><span class="p">)</span><span class="o">.</span><span class="n">pvalue</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>array(3.89455469e-14)
</pre></div>
</div>
</div>
</div>
<p><span class="math notranslate nohighlight">\(\text{H}_0\)</span>は棄却される。</p>
<p><span class="math notranslate nohighlight">\(t\)</span>検定では，<code class="docutils literal notranslate"><span class="pre">female</span></code>と<code class="docutils literal notranslate"><span class="pre">female:educ</span></code>はそれぞれの帰無仮説が棄却されなかったが，<span class="math notranslate nohighlight">\(F\)</span>検定では制約が棄却された。一貫性がなく説明変数が不足している可能性がある。</p>
</div>
</div>
<div class="section" id="id9">
<h2>カテゴリー変数<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<p>カテゴリー変数とは定性的な変数であり，男女もカテゴリー変数の一種である。カテゴリー変数をダミー変数に変換するには2つの方法がある。</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>にはカテゴリー変数に自動的にダミー変数を割り当てる機能がある。操作は簡単で，単に回帰式の中で<code class="docutils literal notranslate"><span class="pre">C()</span></code>の中にカテゴリー変数を入れるだけである。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C()</span></code>を使わない方法。</p></li>
</ol>
<div class="section" id="c">
<h3><code class="docutils literal notranslate"><span class="pre">C()</span></code>を使う方法<a class="headerlink" href="#c" title="Permalink to this headline">¶</a></h3>
<p>式の中にダミー変数を入れるためには，変数が<code class="docutils literal notranslate"><span class="pre">pandas</span></code>のカテゴリー型変数に変換される必要がある。回帰式の中で<code class="docutils literal notranslate"><span class="pre">C()</span></code>を使うと，文字型データなどは自動的に変換される。</p>
<div class="section" id="id10">
<h4>例１<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<p>例として，男女のカテゴリーがある<code class="docutils literal notranslate"><span class="pre">wage1</span></code>のデータセットをもう一度使う。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">wage1</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;wage&#39;</span><span class="p">,</span> <span class="s1">&#39;female&#39;</span><span class="p">,</span> <span class="s1">&#39;educ&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">df</span></code>のメソッド<code class="docutils literal notranslate"><span class="pre">replace()</span></code>を使って<code class="docutils literal notranslate"><span class="pre">female</span></code>の列の値を以下のルールに沿って変換し，それを<code class="docutils literal notranslate"><span class="pre">df</span></code>に<code class="docutils literal notranslate"><span class="pre">sex</span></code>という列として入れ直す。</p>
<ul class="simple">
<li><p>1 <span class="math notranslate nohighlight">\(\Rightarrow\)</span> <code class="docutils literal notranslate"><span class="pre">female</span></code></p></li>
<li><p>0 <span class="math notranslate nohighlight">\(\Rightarrow\)</span> <code class="docutils literal notranslate"><span class="pre">male</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">replace()</span></code>の中は辞書になっている（<code class="docutils literal notranslate"><span class="pre">replace()</span></code>の代わりに<code class="docutils literal notranslate"><span class="pre">map()</span></code>でもOK）。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;sex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;female&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;female&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;male&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wage</th>
      <th>female</th>
      <th>educ</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3.10</td>
      <td>1</td>
      <td>11</td>
      <td>female</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3.24</td>
      <td>1</td>
      <td>12</td>
      <td>female</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.00</td>
      <td>0</td>
      <td>11</td>
      <td>male</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">sex</span></code>の変数を<code class="docutils literal notranslate"><span class="pre">C()</span></code>に入れて回帰式を書いて計算。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">form_c</span> <span class="o">=</span> <span class="s1">&#39;wage ~  C(sex) + educ&#39;</span>

<span class="n">res_c</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">form_c</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">res_c</span><span class="o">.</span><span class="n">params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>Intercept        -1.650545
C(sex)[T.male]    2.273362
educ              0.506452
dtype: float64
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p><code class="docutils literal notranslate"><span class="pre">C(sex)[T.male]</span></code>について</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">T</span></code>は<code class="docutils literal notranslate"><span class="pre">Treatment</span></code>の頭文字で，通常のダミー変数を設定することを示している。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">male</span></code>は<code class="docutils literal notranslate"><span class="pre">male</span></code>の変数であることを表しており，自動的に<code class="docutils literal notranslate"><span class="pre">female</span></code>が基本カテゴリーに設定されたことが分かる。</p></li>
</ul>
<p>（結果）</p>
<p><code class="docutils literal notranslate"><span class="pre">C(sex)[T.male]</span></code>は<code class="docutils literal notranslate"><span class="pre">female</span></code>に比べて<code class="docutils literal notranslate"><span class="pre">male</span></code>の賃金は約2.27ドル高いことを示している。</p>
<hr class="docutils" />
<p>一方で，基本カテゴリーを手動で設定したい場合がある。その場合には<code class="docutils literal notranslate"><span class="pre">C()</span></code>に<code class="docutils literal notranslate"><span class="pre">Treatment(&quot;＜設定したいカテゴリー＞&quot;)</span></code>を引数として追加する。</p>
<p>（注意）<code class="docutils literal notranslate"><span class="pre">Treatment()</span></code>の中は double quotations <code class="docutils literal notranslate"><span class="pre">&quot;</span> <span class="pre">&quot;</span></code>を使用すること。</p>
<p>例えば，<code class="docutils literal notranslate"><span class="pre">male</span></code>を基本カテゴリーとする。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">form_cm</span> <span class="o">=</span> <span class="s1">&#39;wage ~  C(sex,Treatment(&quot;male&quot;)) + educ&#39;</span>

<span class="n">res_cm</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">form_cm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">res_cm</span><span class="o">.</span><span class="n">params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>Intercept                              0.622817
C(sex, Treatment(&quot;male&quot;))[T.female]   -2.273362
educ                                   0.506452
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>この結果は，<code class="docutils literal notranslate"><span class="pre">male</span></code>基本カテゴリーとする以下の結果と同じである。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">form_ca</span> <span class="o">=</span> <span class="s1">&#39;wage ~  female + educ&#39;</span>

<span class="n">res_ca</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">form_ca</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">res_ca</span><span class="o">.</span><span class="n">params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>Intercept    0.622817
female      -2.273362
educ         0.506452
dtype: float64
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id11">
<h4>例２<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p>米国ニュージャージーとペンシルベニアのファースト・フード店で人種と所得によって価格差別をおこなっているかを検証する例を取り上げる。<code class="docutils literal notranslate"><span class="pre">wooldridge</span></code>パッケージのデータセット<code class="docutils literal notranslate"><span class="pre">discrim</span></code>には以下の変数が含まれている。</p>
<ul class="simple">
<li><p>フライド・ポテトの平均価格（<code class="docutils literal notranslate"><span class="pre">pfries</span></code>）</p></li>
<li><p>人口における黒人の比率（<code class="docutils literal notranslate"><span class="pre">prpblck</span></code>）</p></li>
<li><p>平均所得（<code class="docutils literal notranslate"><span class="pre">income</span></code>）</p></li>
<li><p>４つのファースト・フード店（<code class="docutils literal notranslate"><span class="pre">chain</span></code>; カテゴリー変数で1~4の数字が使われている）</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code>: Berger King</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">2</span></code>: KFC</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">3</span></code>: Roy Rogers</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">4</span></code>: Wendy’s</p></li>
</ul>
</li>
</ul>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">discrim</span> <span class="o">=</span> <span class="n">wooldridge</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;discrim&#39;</span><span class="p">)</span>
<span class="n">wooldridge</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;discrim&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>name of dataset: discrim
no of variables: 37
no of observations: 410

+----------+----------------------------------------------+
| variable | label                                        |
+----------+----------------------------------------------+
| psoda    | price of medium soda, 1st wave               |
| pfries   | price of small fries, 1st wave               |
| pentree  | price entree (burger or chicken), 1st wave   |
| wagest   | starting wage, 1st wave                      |
| nmgrs    | number of managers, 1st wave                 |
| nregs    | number of registers, 1st wave                |
| hrsopen  | hours open, 1st wave                         |
| emp      | number of employees, 1st wave                |
| psoda2   | price of medium soday, 2nd wave              |
| pfries2  | price of small fries, 2nd wave               |
| pentree2 | price entree, 2nd wave                       |
| wagest2  | starting wage, 2nd wave                      |
| nmgrs2   | number of managers, 2nd wave                 |
| nregs2   | number of registers, 2nd wave                |
| hrsopen2 | hours open, 2nd wave                         |
| emp2     | number of employees, 2nd wave                |
| compown  | =1 if company owned                          |
| chain    | BK = 1, KFC = 2, Roy Rogers = 3, Wendy&#39;s = 4 |
| density  | population density, town                     |
| crmrte   | crime rate, town                             |
| state    | NJ = 1, PA = 2                               |
| prpblck  | proportion black, zipcode                    |
| prppov   | proportion in poverty, zipcode               |
| prpncar  | proportion no car, zipcode                   |
| hseval   | median housing value, zipcode                |
| nstores  | number of stores, zipcode                    |
| income   | median family income, zipcode                |
| county   | county label                                 |
| lpsoda   | log(psoda)                                   |
| lpfries  | log(pfries)                                  |
| lhseval  | log(hseval)                                  |
| lincome  | log(income)                                  |
| ldensity | log(density)                                 |
| NJ       | =1 for New Jersey                            |
| BK       | =1 if Burger King                            |
| KFC      | =1 if Kentucky Fried Chicken                 |
| RR       | =1 if Roy Rogers                             |
+----------+----------------------------------------------+

K. Graddy (1997), “Do Fast-Food Chains Price Discriminate on the Race
and Income Characteristics of an Area?” Journal of Business and
Economic Statistics 15, 391-401. Professor Graddy kindly provided the
data set.
</pre></div>
</div>
</div>
</div>
<p>それぞれのファースト・フード店の数を確認する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">discrim</span><span class="p">[</span><span class="s1">&#39;chain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>1    171
3     99
2     80
4     60
Name: chain, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>OLS推定をおこなう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">form_p</span> <span class="o">=</span> <span class="s1">&#39;np.log(pfries) ~ prpblck + np.log(income) + C(chain)&#39;</span>

<span class="n">res_p</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">form_p</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">discrim</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">res_p</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>==================================================================================
                     coef    std err          t      P&gt;|t|      [0.025      0.975]
----------------------------------------------------------------------------------
Intercept         -1.0812      0.222     -4.860      0.000      -1.519      -0.644
C(chain)[T.2]     -0.0682      0.014     -4.943      0.000      -0.095      -0.041
C(chain)[T.3]      0.0811      0.013      6.215      0.000       0.055       0.107
C(chain)[T.4]     -0.0434      0.015     -2.892      0.004      -0.073      -0.014
prpblck            0.1317      0.031      4.185      0.000       0.070       0.194
np.log(income)     0.0914      0.021      4.441      0.000       0.051       0.132
==================================================================================
</pre></div>
</div>
</div>
</div>
<p>自動的にBerger Kingが基本カテゴリーに設定されている。</p>
<p>（結果）</p>
<ul>
<li><p>BKとKFCの価格比較</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \ln P_{\text{BK}}-\ln P_{\text{KFC}}=-0.0682 \\
    \quad\Downarrow \\
    \dfrac{P_{\text{BK}}}{P_{\text{KFC}}}=e^{-0.0682}=1.071
    \end{split}\]</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">prpblck</span></code>と<code class="docutils literal notranslate"><span class="pre">np.log(income)</span></code>の<span class="math notranslate nohighlight">\(p\)</span>値は<code class="docutils literal notranslate"><span class="pre">0</span></code>に近く，帰無仮説は１％有意水準でも棄却できる。</p></li>
</ul>
</div>
</div>
<div class="section" id="id12">
<h3><code class="docutils literal notranslate"><span class="pre">C()</span></code>を使わない方法<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>例２を使って説明する。まず説明の前準備として<code class="docutils literal notranslate"><span class="pre">discrim</span></code>の中で使う変数だけを取り出そう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_c</span> <span class="o">=</span> <span class="n">discrim</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;pfries&#39;</span><span class="p">,</span> <span class="s1">&#39;prpblck&#39;</span><span class="p">,</span> <span class="s1">&#39;income&#39;</span><span class="p">,</span> <span class="s1">&#39;chain&#39;</span><span class="p">]]</span>
<span class="n">df_c</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pfries</th>
      <th>prpblck</th>
      <th>income</th>
      <th>chain</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.06</td>
      <td>0.171154</td>
      <td>44534.0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.91</td>
      <td>0.171154</td>
      <td>44534.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.91</td>
      <td>0.047360</td>
      <td>41164.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.02</td>
      <td>0.052839</td>
      <td>50366.0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>NaN</td>
      <td>0.034480</td>
      <td>72287.0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">replace()</span></code>を使って<code class="docutils literal notranslate"><span class="pre">chain</span></code>の列の値を以下のルールに沿って変換する。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> <span class="math notranslate nohighlight">\(\Rightarrow\)</span> Berger King</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">2</span></code> <span class="math notranslate nohighlight">\(\Rightarrow\)</span> KFC</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">3</span></code> <span class="math notranslate nohighlight">\(\Rightarrow\)</span> Roy Rogers</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">4</span></code> <span class="math notranslate nohighlight">\(\Rightarrow\)</span> Wendy’s</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;chain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_c</span><span class="p">[</span><span class="s1">&#39;chain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                        <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;Berger_King&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s1">&#39;KFC&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="s1">&#39;Roy_Rogers&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">:</span><span class="s1">&#39;Wendys&#39;</span><span class="p">})</span>

<span class="n">df_c</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pfries</th>
      <th>prpblck</th>
      <th>income</th>
      <th>chain</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.06</td>
      <td>0.171154</td>
      <td>44534.0</td>
      <td>Roy_Rogers</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.91</td>
      <td>0.171154</td>
      <td>44534.0</td>
      <td>Berger_King</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.91</td>
      <td>0.047360</td>
      <td>41164.0</td>
      <td>Berger_King</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.02</td>
      <td>0.052839</td>
      <td>50366.0</td>
      <td>Roy_Rogers</td>
    </tr>
    <tr>
      <th>4</th>
      <td>NaN</td>
      <td>0.034480</td>
      <td>72287.0</td>
      <td>Berger_King</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>の特徴を確認する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_c</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 410 entries, 0 to 409
Data columns (total 4 columns):
 #   Column   Non-Null Count  Dtype  
---  ------   --------------  -----  
 0   pfries   393 non-null    float64
 1   prpblck  409 non-null    float64
 2   income   409 non-null    float64
 3   chain    410 non-null    object 
dtypes: float64(3), object(1)
memory usage: 12.9+ KB
</pre></div>
</div>
</div>
</div>
<p>列<code class="docutils literal notranslate"><span class="pre">chain</span></code>は<code class="docutils literal notranslate"><span class="pre">object</span></code>となっており文字型であることがわかる。</p>
<p>＜<code class="docutils literal notranslate"><span class="pre">C()</span></code>を使わない方法＞</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pandas</span></code>の関数である<code class="docutils literal notranslate"><span class="pre">pd.Categorical()</span></code>を使って列<code class="docutils literal notranslate"><span class="pre">chain</span></code>を<code class="docutils literal notranslate"><span class="pre">pandas</span></code>のカテゴリー型に変換する。</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_c</span><span class="p">[</span><span class="s1">&#39;chain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">df_c</span><span class="p">[</span><span class="s1">&#39;chain&#39;</span><span class="p">])</span>
<span class="n">df_c</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 410 entries, 0 to 409
Data columns (total 4 columns):
 #   Column   Non-Null Count  Dtype   
---  ------   --------------  -----   
 0   pfries   393 non-null    float64 
 1   prpblck  409 non-null    float64 
 2   income   409 non-null    float64 
 3   chain    410 non-null    category
dtypes: category(1), float64(3)
memory usage: 10.3 KB
</pre></div>
</div>
</div>
</div>
<p>列<code class="docutils literal notranslate"><span class="pre">chain</span></code>は<code class="docutils literal notranslate"><span class="pre">category</span></code>になっている。後は，<code class="docutils literal notranslate"><span class="pre">chain</span></code>をそのまま回帰式に使うだけである。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">form_c</span> <span class="o">=</span> <span class="s1">&#39;np.log(pfries) ~ prpblck + np.log(income) + chain&#39;</span>

<span class="n">res_c</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">form_c</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_c</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">res_c</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>=======================================================================================
                          coef    std err          t      P&gt;|t|      [0.025      0.975]
---------------------------------------------------------------------------------------
Intercept              -1.0812      0.222     -4.860      0.000      -1.519      -0.644
chain[T.KFC]           -0.0682      0.014     -4.943      0.000      -0.095      -0.041
chain[T.Roy_Rogers]     0.0811      0.013      6.215      0.000       0.055       0.107
chain[T.Wendys]        -0.0434      0.015     -2.892      0.004      -0.073      -0.014
prpblck                 0.1317      0.031      4.185      0.000       0.070       0.194
np.log(income)          0.0914      0.021      4.441      0.000       0.051       0.132
=======================================================================================
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">C()</span></code>を使って推定した結果と同じである。</p>
</div>
</div>
</div>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="12_Asymptotics.html" title="previous page">大標本特性</a>
    <a class='right-next' id="next-link" href="14_Heteroskedasticity.html" title="next page">不均一分散</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By 春山 鉄源<br/>
        
            &copy; Copyright 2020 Tetsugen Haruyama.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="_static/js/index.js"></script>
    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-165998213-1', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    
  </body>
</html>