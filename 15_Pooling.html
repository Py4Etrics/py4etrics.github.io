
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>プーリング・データとパネル・データ &#8212; Pythonで学ぶ入門計量経済学</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=87e54e7c" />
    <link rel="stylesheet" type="text/css" href="_static/myadmonitions.css?v=372cf325" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-6SP1Y69WEX"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-6SP1Y69WEX');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-6SP1Y69WEX');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '15_Pooling';</script>
    <link rel="canonical" href="https://py4etrics.github.io/15_Pooling.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="linearmodels" href="16_linearmodels.html" />
    <link rel="prev" title="不均一分散" href="14_Hetero.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">Pythonで学ぶ入門計量経済学</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Pythonの学習</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="part_1.html">目次と内容</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_Python_Basics.html">Pythonの基礎</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_NumPy.html">NumPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_Pandas.html">Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_Matplotlib.html">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_SciPy_stats.html">SciPy.stats</a></li>
<li class="toctree-l1"><a class="reference internal" href="6_things_to_note.html">Tipsと注意点</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Pythonを使った計量経済分析</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="part_2.html">目次と内容</a></li>
<li class="toctree-l1"><a class="reference internal" href="7_Review_of_Statistics.html">統計学の簡単な復習</a></li>
<li class="toctree-l1"><a class="reference internal" href="list_of_terms.html">計量経済学用語</a></li>
<li class="toctree-l1"><a class="reference internal" href="8_Simple_Regression.html">単回帰分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="9_Multiple_Regression.html">重回帰分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_Residuals.html">残差診断</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_Inference.html">推論</a></li>
<li class="toctree-l1"><a class="reference internal" href="12_Asymptotics.html">大標本特性</a></li>
<li class="toctree-l1"><a class="reference internal" href="13_Dummies.html">質的変数と回帰分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="14_Hetero.html">不均一分散</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">プーリング・データとパネル・データ</a></li>
<li class="toctree-l1"><a class="reference internal" href="16_linearmodels.html"><code class="docutils literal notranslate"><span class="pre">linearmodels</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="17_Panel.html">パネル・データ分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="18_Zero_Conditional_Mean.html">GM仮定４が満たされない場合</a></li>
<li class="toctree-l1"><a class="reference internal" href="19_IV2SLS.html">操作変数法と２段階OLS</a></li>
<li class="toctree-l1"><a class="reference internal" href="20_LogitProbit.html">離散選択モデル</a></li>
<li class="toctree-l1"><a class="reference internal" href="21_TruncregTobitHeckit.html">制限従属変数モデル</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">番外編</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="part_3.html">目次と内容</a></li>
<li class="toctree-l1"><a class="reference internal" href="Descriptive_stats_vs_Graphs.html">記述統計とグラフ</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_source.html">Data</a></li>
<li class="toctree-l1"><a class="reference external" href="https://py4macro.github.io">Pythonで学ぶマクロ経済学 (中級＋レベル)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://py4basics.github.io">経済学のためのPython入門</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/Py4Etrics/py4etrics.github.io/source?urlpath=tree/15_Pooling.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/Py4Etrics/py4etrics.github.io/blob/source/15_Pooling.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>



<a href="https://github.com/Py4Etrics/py4etrics.github.io" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/15_Pooling.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>プーリング・データとパネル・データ</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">説明</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">独立に分布したプーリング・データ</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">プーリング・データの応用：差分の差分析</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">説明</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#did"><code class="docutils literal notranslate"><span class="pre">DiD</span></code>推定</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">パネル・データとその問題点</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">パネル・データについて</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ols">OLS推定の問題点</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#groupby">１階差分推定の準備：<code class="docutils literal notranslate"><span class="pre">groupby</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">１階差分推定</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">説明</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">推定：２期間の場合</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">推定：３期間以上の場合</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>プーリング・データとパネル・データ<a class="headerlink" href="#id1" title="Link to this heading">#</a></h1>
<div name="html-admonition" style="font-size: 0.8em">
<input type="button" onclick="location.href='https://translate.google.com/translate?hl=&sl=ja&tl=en&u='+window.location;" value="Google translation" style="color:#ffffff;background-color:#008080; height:25px" onmouseover="this.style.background='#99ccff'" onmouseout="this.style.background='#008080'"/> in English or the language of your choice.
</div><br><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">wooldridge</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">t</span>
<span class="kn">from</span> <span class="nn">statsmodels.formula.api</span> <span class="kn">import</span> <span class="n">ols</span>

<span class="c1"># 警告メッセージを非表示</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="id2">
<h2>説明<a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<p>独立に分布したプーリング・データ（independently distributed pooling data）とパネル・データ（panel data）を考える。両方とも横断面データと時系列データの両方の特徴を兼ね備えたデータである。</p>
<hr class="docutils" />
<p><strong>独立に分布したプーリング・データ</strong>には以下の特徴がある。</p>
<ul class="simple">
<li><p>ある期間（例えば，2000年から2010年の間）に期間毎無作為に観察単位（例えば，消費者や企業）が抽出される。従って，時間（年次データであれば年）が違えば観察単位は変化する。</p></li>
<li><p>時間の変化により必ずしも<strong>同一分布</strong>とはならない（即ち，分布は時間によって変化するかも知れない）。</p></li>
</ul>
<p>日本の統計の例に<a class="reference external" href="http://www.stat.go.jp/data/roudou/index.html">労働力調査</a>がある。</p>
<p>＜プーリング・データを使う利点＞</p>
<ul class="simple">
<li><p>横断データと比べるとデータ数が増えるため，より正確な推定量や検定統計量を得ることが可能となる。</p></li>
<li><p>時間軸にそって独立した分布から標本を抽出するため，誤差項に自己相関はない。</p></li>
</ul>
<hr class="docutils" />
<p><strong>パネル・データ</strong>には以下の特徴がある。</p>
<ul class="simple">
<li><p>初期時点で無作為に観察単位（例えば，消費者や企業）を抽出し，同じ観測単位を時間軸に沿って観測して集めたデータである。</p></li>
<li><p>観測単位が同じであることが独立に分布したプーリング・データとの違いである。</p></li>
</ul>
<p>＜パネル・データを使う意義＞</p>
<p>例として，各都道府県で行われた公共支出が県内の雇用に与える影響を推定したいとしよう。</p>
<ul class="simple">
<li><p>観察単位：47都道府県 <span class="math notranslate nohighlight">\(i=1,2,...,47\)</span></p></li>
<li><p>時系列範囲：2000~2020年 <span class="math notranslate nohighlight">\(t=2000,2001,...,2020\)</span></p></li>
<li><p>変数：県内の雇用（<span class="math notranslate nohighlight">\(L\)</span>），公共支出（<span class="math notranslate nohighlight">\(G\)</span>），<span class="math notranslate nohighlight">\(x\)</span>は「その他の変数」</p></li>
</ul>
<p>47都道府県と時間の２次元データとなっているため，次の推定方法が考えられる。</p>
<ul>
<li><p>年別に横断面データとしてクロス・セクション分析行う。</p>
<div class="math notranslate nohighlight">
\[y_i = \beta_{0} + \beta_{1} G_i + \beta_{2}x_i + u_i\]</div>
<p>しかし，それぞれの推定は20年間の間に起こる要因の変化の効果を無視することになり，公的支出の動的な側面を捉えていない。</p>
</li>
<li><p>47都道府県別に時系列の推定を行う。</p>
<div class="math notranslate nohighlight">
\[y_t = \beta_{0} + \beta_{1} G_t + \beta_{2}x_t+ u_t\]</div>
<p>しかし，それぞれの推定は同じ日本の地域でありながら他の都道府県の影響を無視することになる。</p>
</li>
</ul>
<p>このように2次元のデータの1つの軸に沿ったデータだけを使うと何らかの影響を無視することになりうる。換言すると，パネル・データを使い異なる観察単位の動的なデータから得る情報を有効に使うことにより，より正確な推定量や検定統計量を得ることができることになる。</p>
</section>
<section id="id3">
<h2>独立に分布したプーリング・データ<a class="headerlink" href="#id3" title="Link to this heading">#</a></h2>
<p>このタイプのデータ扱う上で注意する点：</p>
<ul class="simple">
<li><p>時系列の変数があるにも関わらず，被説明変数と少なくとも一部の説明変数とは時間不変の関係にあると暗に仮定することになる。</p></li>
<li><p>時系列の要素があるため，変数は必ずしも同一分布から抽出さる訳ではない。例えば，多くの経済で賃金と教育水準の分布は変化していると考える方が妥当である。この問題に対処するために時間ダミーを使うことになる。</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">CPS78_85</span></code>のデータを使い推定方法を説明する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># データの読み込み</span>
<span class="n">cps</span> <span class="o">=</span> <span class="n">wooldridge</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;CPS78_85&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># データの読み込み</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">cps</span> <span class="o">=</span> <span class="n">wooldridge</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;CPS78_85&#39;</span><span class="p">)</span>

<span class="nn">File /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/wooldridge/load_data.py:58,</span> in <span class="ni">data</span><span class="nt">(name, description)</span>
<span class="g g-Whitespace">     </span><span class="mi">55</span> <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">description</span> <span class="o">==</span> <span class="kc">False</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span>     <span class="n">full_file_path</span> <span class="o">=</span> <span class="n">_find_full_file_path</span><span class="p">(</span><span class="n">_get_path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="n">name</span><span class="o">+</span><span class="s2">&quot;.csv.bz2&quot;</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">58</span>     <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">full_file_path</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;bz2&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">60</span> <span class="k">elif</span> <span class="p">(</span><span class="n">name</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">description</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span>     <span class="n">full_file_path</span> <span class="o">=</span> <span class="n">_find_full_file_path</span><span class="p">(</span><span class="n">_get_path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="n">name</span><span class="o">+</span><span class="s2">&quot;.txt&quot;</span><span class="p">)</span>

<span class="nn">File /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/pandas/io/parsers/readers.py:1026,</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, date_format, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options, dtype_backend)</span>
<span class="g g-Whitespace">   </span><span class="mi">1013</span> <span class="n">kwds_defaults</span> <span class="o">=</span> <span class="n">_refine_defaults_read</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1014</span>     <span class="n">dialect</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1015</span>     <span class="n">delimiter</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1022</span>     <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1023</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1024</span> <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1026</span> <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

<span class="nn">File /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/pandas/io/parsers/readers.py:620,</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">617</span> <span class="n">_validate_names</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;names&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">619</span> <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">620</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">622</span> <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">623</span>     <span class="k">return</span> <span class="n">parser</span>

<span class="nn">File /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/pandas/io/parsers/readers.py:1620,</span> in <span class="ni">TextFileReader.__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">   </span><span class="mi">1617</span>     <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">1619</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span> <span class="n">IOHandles</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">-&gt; </span><span class="mi">1620</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>

<span class="nn">File /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/pandas/io/parsers/readers.py:1880,</span> in <span class="ni">TextFileReader._make_engine</span><span class="nt">(self, f, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1878</span>     <span class="k">if</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1879</span>         <span class="n">mode</span> <span class="o">+=</span> <span class="s2">&quot;b&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1880</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="o">=</span> <span class="n">get_handle</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1881</span>     <span class="n">f</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1882</span>     <span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1883</span>     <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1884</span>     <span class="n">compression</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1885</span>     <span class="n">memory_map</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_map&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1886</span>     <span class="n">is_text</span><span class="o">=</span><span class="n">is_text</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1887</span>     <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1888</span>     <span class="n">storage_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storage_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1889</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1890</span> <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">   </span><span class="mi">1891</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="o">.</span><span class="n">handle</span>

<span class="nn">File /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/pandas/io/common.py:728,</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">725</span>     <span class="n">codecs</span><span class="o">.</span><span class="n">lookup_error</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">727</span> <span class="c1"># open URLs</span>
<span class="ne">--&gt; </span><span class="mi">728</span> <span class="n">ioargs</span> <span class="o">=</span> <span class="n">_get_filepath_or_buffer</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">729</span>     <span class="n">path_or_buf</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">730</span>     <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">731</span>     <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">732</span>     <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">733</span>     <span class="n">storage_options</span><span class="o">=</span><span class="n">storage_options</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">734</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">736</span> <span class="n">handle</span> <span class="o">=</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">filepath_or_buffer</span>
<span class="g g-Whitespace">    </span><span class="mi">737</span> <span class="n">handles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BaseBuffer</span><span class="p">]</span>

<span class="nn">File /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/pandas/io/common.py:472,</span> in <span class="ni">_get_filepath_or_buffer</span><span class="nt">(filepath_or_buffer, encoding, compression, mode, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">468</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">469</span>     <span class="nb">hasattr</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="s2">&quot;read&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">470</span> <span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">471</span>     <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Invalid file path or buffer object type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="ne">--&gt; </span><span class="mi">472</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">474</span> <span class="k">return</span> <span class="n">IOArgs</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">475</span>     <span class="n">filepath_or_buffer</span><span class="o">=</span><span class="n">filepath_or_buffer</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">476</span>     <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">479</span>     <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">480</span> <span class="p">)</span>

<span class="ne">ValueError</span>: Invalid file path or buffer object type: &lt;class &#39;NoneType&#39;&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># データの内容の確認</span>
<span class="n">wooldridge</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;CPS78_85&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>このデータセットには1978年と1985年の変数があり，ダミー変数に次のものが含まれている。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">y85</span></code>：1985年の時間ダミー変数</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">female</span></code>：男女のダミー変数</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">union</span></code>：労働組合員かどうかのダミー変数</p></li>
</ul>
<p>これを使い，賃金と教育の関係を検証する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 回帰分析</span>

<span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;lwage ~ y85 + educ + female + </span><span class="se">\</span>
<span class="s1">                   y85:educ + y85:female + </span><span class="se">\</span>
<span class="s1">                   exper + I((exper**2)/100) + union&#39;</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">cps</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>（コメント）</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">y85</span> <span class="pre">+</span> <span class="pre">educ</span> <span class="pre">+</span> <span class="pre">female</span> <span class="pre">+</span> <span class="pre">y85:educ</span> <span class="pre">+</span> <span class="pre">y85:female</span></code>の部分は長いので<code class="docutils literal notranslate"><span class="pre">y85*(educ+female)</span></code>と省略して記述しても結果は同じ。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lwage</span></code>は名目賃金の対数の値である。この場合，実質賃金を考える方が自然なため，インフレの影響を取り除く必要がある。1978年と1985年の消費者物価指数をそれぞれ<span class="math notranslate nohighlight">\(p_{78}\)</span>と<span class="math notranslate nohighlight">\(p_{85}\)</span>とすると，その比率<span class="math notranslate nohighlight">\(P\equiv p_{85}/p_{78}\)</span>がその間のインフレの影響を捉える変数と考える。<span class="math notranslate nohighlight">\(P\)</span>を使い1985年の賃金を次式に従って実質化できる。</p>
<div class="math notranslate nohighlight">
\[
    \ln\left(\text{実質賃金}_{85}\right) = \ln\left(\frac{\text{名目賃金}_{85}}{P}\right) = \ln\left(\text{名目賃金}_{85}\right)-\ln(P) = \text{85年のlwage}- \ln(P)
    \]</div>
<p>この式から<span class="math notranslate nohighlight">\(\ln(P)\)</span>は回帰式の右辺の定数項に含まれることがわかる。即ち，上の式を変えることなく<code class="docutils literal notranslate"><span class="pre">educ</span></code>の係数は実質賃金で測った教育の収益率，<code class="docutils literal notranslate"><span class="pre">female</span></code>は実質賃金での男女賃金格差と解釈できる。</p>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>教育の収益率</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">educ</span></code>の係数0.0747が1978年における教育1年の収益率（約7.5%）。統計的有意性は非常に高い（p-value=0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y85:educ</span></code>の係数0.0185は1978年と1985年の値の差を表している。1985年の収益率は1.85%高く，5％水準で帰無仮説（1978年と1985年の収益率は同じ）を棄却できる。1985年の1年間の収益率は0.0747+0.0185=0.0932である（約9.3%）。</p></li>
</ul>
<p>男女間の賃金格差</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">female</span></code>の係数<code class="docutils literal notranslate"><span class="pre">-0.3167</span></code>は1978年における値。即ち，女性の賃金は男性より約32%低く，統計的有意性は非常に高い（p値=0）。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y85:female</span></code>の係数0.0851は1978年と1985年の値の差を表しており，1985年の賃金格差は約8.5%改善したことを意味する。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y85:female</span></code>のp値0.098は両側検定であり，10％水準で帰無仮説（賃金格差は変化していない）を棄却できるが，5%水準では棄却できない。</p></li>
<li><p>一方，<code class="docutils literal notranslate"><span class="pre">y85:female</span></code>は正の値であり，女性の賃金の改善が統計的有意かどうかが問題になる。この点を考慮し片側検定をおこなう。</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(H_0\)</span>: <code class="docutils literal notranslate"><span class="pre">y85:female</span></code>の係数 <span class="math notranslate nohighlight">\(＝0\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(H_a\)</span>: <code class="docutils literal notranslate"><span class="pre">y85:female</span></code>の係数 <span class="math notranslate nohighlight">\(&gt;0\)</span></p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t_value</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="s1">&#39;y85:female&#39;</span><span class="p">]</span>  <span class="c1"># y85:femaleのt値</span>

<span class="n">dof</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">df_resid</span>  <span class="c1"># 自由度 n-k-1</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code>を使い計算する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">t_value</span><span class="p">,</span> <span class="n">dof</span><span class="p">)</span>  <span class="c1"># p値の計算</span>
</pre></div>
</div>
</div>
</div>
<p>片側検定では，5%水準で帰無仮説を棄却できる。</p>
</section>
<section id="id4">
<h2>プーリング・データの応用：差分の差分析<a class="headerlink" href="#id4" title="Link to this heading">#</a></h2>
<section id="id5">
<h3>説明<a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<p>差分の差分析（Difference-in-Differences; DiD）を使うとプーリング・データを使い政策の効果を検証できる。</p>
<p>＜基本的な考え＞</p>
<ul>
<li><p>例として，ゴミ焼却場の建築が近隣住宅価格に与える影響を考える。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">t</span></code>=0：政策実施前の年</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">t</span></code>=1：政策実施後の年</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">D</span></code>：住宅がゴミ焼却場の近くであれば１，そうでなければ０（距離のダミー変数）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y</span></code>：住宅価格</p></li>
<li><p>仮定：ゴミ焼却場が建設されなかったとしたら，データにある全ての住宅価格は同じ率で増加していただろう。</p></li>
<li><p>次式を使って政策実施前と後それぞれで推定</p>
<div class="math notranslate nohighlight">
\[y_t = \alpha_t + \gamma_t D + u\qquad t=0,1\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\hat{y}_0^{\text{遠}}=\hat{\alpha}_0\)</span>：政策実施前の遠くに立地する住宅価格の平均</p></li>
<li><p><span class="math notranslate nohighlight">\(\hat{y}_0^{\text{近}}=\hat{\alpha}_0+\hat{\gamma}_0\)</span>：政策実施前の近くに立地する住宅価格の平均</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\hat{\gamma}_0\)</span>：政策実施前の遠くと近くに立地する住宅価格の<strong>差</strong></p></li>
</ul>
</li>
<li><p><span class="math notranslate nohighlight">\(\hat{y}_1^{\text{遠}}=\hat{\alpha}_1\)</span>：政策実施後の遠くに立地する住宅価格の平均</p></li>
<li><p><span class="math notranslate nohighlight">\(\hat{y}_1^{\text{近}}=\hat{\alpha}_1+\hat{\gamma}_1\)</span>：政策実施後の近くに立地する住宅価格の平均</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\hat{\gamma}_1\)</span>：政策実施後の遠くと近くに立地する住宅価格の<strong>差</strong></p></li>
</ul>
</li>
</ul>
</li>
<li><p>解釈（下の図を参考に）：</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\hat{\gamma}_0\)</span>は政策実施前の住宅価格の差を示す。</p></li>
<li><p><span class="math notranslate nohighlight">\(\hat{\gamma}_1\)</span>は政策実施後の住宅価格の差を示す。</p></li>
<li><p><span class="math notranslate nohighlight">\(\left(\hat{\gamma}_1-\hat{\gamma}_0\right)\)</span>は政策実施後と前の住宅価格の差の差を示す。この「差の差」の変化で近くに立地する住宅価格の変化を考えることができる。もしこの差の差が<code class="docutils literal notranslate"><span class="pre">0</span></code>であれば（即ち，差は同じだった），住宅価格は影響を受けなかったと解釈できる。もしこの差がマイナスであれば（即ち，差に違いが生じた）近くに立地する住宅の価格は減少してしたと考えられる。</p></li>
</ul>
</li>
</ul>
<a class="reference internal image-reference" href="_images/did.png"><img alt="_images/did.png" class="align-center" src="_images/did.png" style="width: 397.5px; height: 298.5px;" /></a>
<p>上の議論から次のことが分かる。</p>
<ul>
<li><p>住宅価格の変化は上の図で示しているように次の「差の差」で捉えることができる。</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \begin{align*}
    \hat{\gamma}_1^{\text{}}-\hat{\gamma}_0&amp;=\hat{y}_1^{\text{近}}-\hat{y}_0^{\text{近}}-\left(\hat{\alpha}_1-\hat{\alpha}_0\right) \\
    &amp;=\left(\hat{y}_1^{\text{近}}-\hat{y}_0^{\text{近}}\right)-\left(\hat{y}_1^{\text{遠}}-\hat{y}_0^{\text{遠}}\right) \\ 
    &amp;=\left(\hat{y}_1^{\text{近}}-\hat{y}_1^{\text{遠}}\right)-\left(\hat{y}_0^{\text{近}}-\hat{y}_0^{\text{遠}}\right)
    \end{align*}
    \end{split}\]</div>
</li>
<li><p>住宅価格の変化の間違った計算：</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\hat{y}_1^{\text{近}}-\hat{y}_0^{\text{近}}=\left(\hat{\alpha}_1-\hat{\alpha}_0\right)+\left(\hat{\gamma}_1-\hat{\gamma}_0\right)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\left(\hat{\alpha}_1-\hat{\alpha}_0\right)\)</span>は，ゴミ焼却場建設から影響を「受けない（仮定）」遠
い場所に立地する住宅価格が時間と共に変化する部分を捉えており，ゴミ焼却場建設と関係なく発生する価格変化である。この部分を取り除かなければ，ゴミ焼却場建設の効果の推定量にバイアスが発生する。</p></li>
</ul>
</li>
</ul>
<hr class="docutils" />
<p>＜<code class="docutils literal notranslate"><span class="pre">DiD</span></code>推定方法＞</p>
<ul>
<li><p>通常の<code class="docutils literal notranslate"><span class="pre">OLS</span></code>を使うが，時間ダミー変数を導入する。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">T</span></code>：<code class="docutils literal notranslate"><span class="pre">t</span></code>=0の場合は０，<code class="docutils literal notranslate"><span class="pre">t</span></code>=1の場合は１</p></li>
</ul>
</li>
<li><p>推定式：</p>
<div class="math notranslate nohighlight">
\[
    y=\beta_0+\delta_0T + \beta_1D + \delta_1TD + u
    \]</div>
</li>
</ul>
<p>＜ダミー変数の値により4つのケースがある＞</p>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">T</span></code>=<code class="docutils literal notranslate"><span class="pre">D</span></code>=0の場合</p>
<div class="math notranslate nohighlight">
\[
    y=\beta_0 + u
    \]</div>
<p><span class="math notranslate nohighlight">\(\hat{y}_{0}^{\text{遠}}\equiv\hat{\beta}_0\)</span>：政策実施前の遠くに立地する住宅の平均価格
<br></p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">T</span></code>=0 と <code class="docutils literal notranslate"><span class="pre">D</span></code>=1の場合</p>
<div class="math notranslate nohighlight">
\[
    y=\beta_0 + \beta_1D + u
    \]</div>
<p><span class="math notranslate nohighlight">\(\hat{y}_{0}^{\text{近}}\equiv\hat{\beta}_0+\hat{\beta}_1\)</span>：政策実施前の近くに立地する住宅の平均価格
<br></p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">T</span></code>=1 と <code class="docutils literal notranslate"><span class="pre">D</span></code>=0の場合</p>
<div class="math notranslate nohighlight">
\[
    y=\beta_0 + \delta_0T + u
    \]</div>
<p><span class="math notranslate nohighlight">\(\hat{y}_{1}^{\text{遠}}\equiv\hat{\beta}_0+\hat{\delta}_0\)</span>：政策実施後の遠くに立地する住宅の平均価格
<br></p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">T</span></code>=<code class="docutils literal notranslate"><span class="pre">D</span></code>=1の場合</p>
<div class="math notranslate nohighlight">
\[
    y=\beta_0 + \delta_0T + \beta_1D + \delta_1TD + u
    \]</div>
<p><span class="math notranslate nohighlight">\(\hat{y}_{1}^{\text{近}}\equiv\hat{\beta}_0+\hat{\delta}_0+\hat{\beta}_1+\hat{\delta}_1\)</span>：政策実施後の近くに立地する住宅の平均価格</p>
</li>
</ol>
<p>ここでの関心事は<span class="math notranslate nohighlight">\(\hat{\delta}_1\)</span>の推定値（負かどうか）であり，その統計的優位性である。この定義を使うと次式が成立することが確認できる。</p>
<div class="math notranslate nohighlight">
\[\hat{\delta}_1=\left(\hat{y}_1^{\text{近}}-\hat{y}_1^{\text{遠}}\right)-\left(\hat{y}_0^{\text{近}}-\hat{y}_0^{\text{遠}}\right)\]</div>
<p>これは上で導出した式にある<span class="math notranslate nohighlight">\(\hat{\gamma}_1^{\text{}}-\hat{\gamma}_0\)</span>と同じである。</p>
</section>
<section id="did">
<h3><code class="docutils literal notranslate"><span class="pre">DiD</span></code>推定<a class="headerlink" href="#did" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">keilmc</span></code>のデータを使いゴミ焼却場建設の近隣住宅価格に対する効果を実際に推計する。</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kielmc</span> <span class="o">=</span> <span class="n">wooldridge</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;kielmc&#39;</span><span class="p">)</span>

<span class="n">wooldridge</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;kielmc&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;rprice ~ nearinc + y81 + nearinc:y81&#39;</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">kielmc</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>（コメント）</p>
<ul class="simple">
<li><p>右辺を<code class="docutils literal notranslate"><span class="pre">nearinc</span> <span class="pre">*</span> <span class="pre">y81</span></code>と省略可能。</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nearinc:y81</span></code>の係数は約-11860であり，10%水準の両側検定でも帰無仮説（係数は0）を棄却できない。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nearinc:y81</span></code>は負の値であり住宅価格が減少したかを検証したい。従って，次の片側検定を行う。</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(H_0\)</span>: <code class="docutils literal notranslate"><span class="pre">nearinc:y81</span></code>の係数 <span class="math notranslate nohighlight">\(＝0\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(H_a\)</span>: <code class="docutils literal notranslate"><span class="pre">nearinc:y81</span></code>の係数 <span class="math notranslate nohighlight">\(&lt;0\)</span></p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t_value</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="s1">&#39;nearinc:y81&#39;</span><span class="p">]</span>  <span class="c1"># t値</span>

<span class="n">dof</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">df_resid</span>  <span class="c1"># 自由度 n-k-1</span>

<span class="n">t</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">t_value</span><span class="p">,</span> <span class="n">dof</span><span class="p">)</span>  <span class="c1"># p値の計算</span>
</pre></div>
</div>
</div>
</div>
<p>片側検定では，10%水準で帰無仮説は棄却できるが，5%水準では棄却できない。負の効果のある程度の統計的有意性はあるようである。一方，上の回帰分析には次のことが言える。</p>
<ul class="simple">
<li><p>左辺には住宅価格の対数を置く方が妥当ではないか。それにより，価格変化をパーセンテージ推計できると同時に，実質価格という解釈も成立する。</p></li>
<li><p>住宅価格に与える他の変数が欠落している可能性がある。</p></li>
</ul>
<hr class="docutils" />
<p>この2点を踏まえて，再度推定をおこなう。</p>
<p>まず，<code class="docutils literal notranslate"><span class="pre">NumPy</span></code>を使い住宅価格に対数をとり推計する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula_1</span> <span class="o">=</span> <span class="s1">&#39;np.log(rprice) ~ nearinc * y81&#39;</span>

<span class="n">result_1</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">formula_1</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">kielmc</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result_1</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>（結果）</p>
<ul class="simple">
<li><p>特に<code class="docutils literal notranslate"><span class="pre">nearinc:y81</span></code>の係数の統計的有意性が上昇したわけではない。</p></li>
</ul>
<p>次に，住宅価格に影響を及ぼしそうな変数を追加する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula_2</span> <span class="o">=</span> <span class="s1">&#39;np.log(rprice) ~ nearinc * y81 + age + I(age**2) + </span><span class="se">\</span>
<span class="s1">            np.log(intst) + np.log(land) + np.log(area) + rooms + baths&#39;</span>

<span class="n">result_2</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">formula_2</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">kielmc</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result_2</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>（結果）</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nearinc:y81</span></code>の係数は，住宅価格が13.1%下落したことを示している。</p></li>
<li><p>p値はこの経済的効果が非常に有意にゼロではないことを示している。</p></li>
</ul>
</section>
</section>
<section id="id6">
<h2>パネル・データとその問題点<a class="headerlink" href="#id6" title="Link to this heading">#</a></h2>
<section id="id7">
<h3>パネル・データについて<a class="headerlink" href="#id7" title="Link to this heading">#</a></h3>
<p>パネル・データを使い推定する場合，観察単位<span class="math notranslate nohighlight">\(i\)</span>と時間<span class="math notranslate nohighlight">\(t\)</span>の２つ次元を考慮した回帰式となる。説明を具体化するために，47都道府県での雇用に対する公共支出の効果を考えよう。</p>
<div class="math notranslate nohighlight">
\[
y_{it}= \alpha_{it} +\beta_1x_{it}+u_{it}\qquad i=1,2,...,n\quad t=1,2
\]</div>
<p>ここで</p>
<div class="math notranslate nohighlight">
\[
\alpha_{i}=\beta_0+a_{i}+\delta_0D_t
\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(y_{it}\)</span>：都道府県<span class="math notranslate nohighlight">\(i\)</span>の<span class="math notranslate nohighlight">\(t\)</span>時点における雇用</p></li>
<li><p><span class="math notranslate nohighlight">\(x_{it}\)</span>：都道府県<span class="math notranslate nohighlight">\(i\)</span>の<span class="math notranslate nohighlight">\(t\)</span>時点における公共支出</p></li>
<li><p><span class="math notranslate nohighlight">\(\alpha_{it}\)</span>：回帰曲線の切片。</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(i\)</span>がある（都道府県によって切片が異なる）理由：都道府県の間に存在しうる異質性を捉えている。</p>
<ul>
<li><p>例えば，他県の公共支出からの影響を受けやすい（若しくは，受けにくい）県がある可能性がある。また，海に接している県や内陸の県では公共支出の効果は異なるかも知れない。また働き方や公共支出に対する県民特有の考え方や好みの違いもありうる。こういう要素は変化には時間が掛かり，推定期間内であれば一定と考えることができる。ありとあらゆる異質性が含まれるため，観察不可能と考えられる。</p></li>
</ul>
</li>
<li><p><span class="math notranslate nohighlight">\(t\)</span>がある理由：公共支出以外の理由で時間と共に雇用は変化するかもしれない。時間トレンドの効果を捉える。</p></li>
<li><p>都道府県特有の定数項は3つに分ける。</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\beta_0\)</span>：共通の定数項</p></li>
<li><p><span class="math notranslate nohighlight">\(a_{i}\)</span>：都道府県別の定数項（<strong>観察不可能</strong>）</p></li>
<li><p><span class="math notranslate nohighlight">\(\delta_0D_t\)</span>：時間による切片の変化を捉えており，<span class="math notranslate nohighlight">\(D_t\)</span>は時間ダミー変数</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(D_0=0\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(D_1=1\)</span></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><span class="math notranslate nohighlight">\(u_{it}\)</span>：時間によって変化する観測不可能な誤差項（<span class="math notranslate nohighlight">\(i\)</span>と<span class="math notranslate nohighlight">\(t\)</span>に依存する誤差項であり，idiosyncratic errorsと呼ばれることがある）</p>
<ul>
<li><p>仮定：<span class="math notranslate nohighlight">\(\text{Cov}(x_{it},u_{it})=0\)</span></p></li>
</ul>
</li>
</ul>
</section>
<section id="ols">
<h3>OLS推定の問題点<a class="headerlink" href="#ols" title="Link to this heading">#</a></h3>
<p><span class="math notranslate nohighlight">\(a_i\)</span>は観察不可能なため，上の回帰式は次のように表すことができる。</p>
<div class="math notranslate nohighlight">
\[
y_{it}= \beta_0 + \delta_0D_t + \beta_1x_{it}+e_{it}\qquad e_{it}=a_i+u_{it}
\]</div>
<p>ここで<span class="math notranslate nohighlight">\(e_{it}\)</span>は観察不可能な誤差項。</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(x_{it}\)</span>と<span class="math notranslate nohighlight">\(a_i\)</span>とが相関する場合，<span class="math notranslate nohighlight">\(x_{it}\)</span>と<span class="math notranslate nohighlight">\(e_{it}\)</span>は相関することになり，GM仮定４は成立しなくなる。</p>
<div class="math notranslate nohighlight">
\[
    \text{Cov}\left(x_{it}a_{it}\right)\neq 0\quad \Rightarrow\quad \text{Cov}\left(x_{it}e_{it}\right)\neq 0
    \]</div>
<p>即ち，<span class="math notranslate nohighlight">\(\hat{\beta}_1\)</span>は不偏性と一致性を失うことになる。</p>
</li>
<li><p>「異質性バイアス」と呼ばれるが，本質的には<span class="math notranslate nohighlight">\(a_i\)</span>の欠落変数バイアスである。</p></li>
</ul>
</section>
</section>
<section id="groupby">
<h2>１階差分推定の準備：<code class="docutils literal notranslate"><span class="pre">groupby</span></code><a class="headerlink" href="#groupby" title="Link to this heading">#</a></h2>
<p>パネル・データを使った推定方法として１階差分推定（First Differenced Estimator）があり，それを使い推定する。その前準備として変数の差分の作成方法について説明する。</p>
<p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>にはメソッド<code class="docutils literal notranslate"><span class="pre">groupby</span></code>があり，これを使うとカテゴリー変数がある列に従って行をグループ分けしグループ毎の様々な計算が可能となる。具体的な例としては<a class="reference external" href="https://github.com/Haruyama-KobeU/Py4Etrics/blob/master/Gapminder.ipynb">Gapminder</a>を参照。ここでは<code class="docutils literal notranslate"><span class="pre">groupby</span></code>を使い差分の変数の作り方を説明する。</p>
<p>例として使うデータを読み込む。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># url の設定</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/Haruyama-KobeU/Haruyama-KobeU.github.io/master/data/data4.csv&#39;</span>

<span class="c1"># 読み込み</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<p>列<code class="docutils literal notranslate"><span class="pre">country</span></code>がカテゴリー変数であり，3つの国がある。この列を使いグループ分けする。</p>
<p>まず前準備として，メソッド<code class="docutils literal notranslate"><span class="pre">.sort_values()</span></code>を使い列<code class="docutils literal notranslate"><span class="pre">country</span></code>で昇順に並び替え，その後，列<code class="docutils literal notranslate"><span class="pre">year</span></code>で昇順に並び替える。</p>
<p>（コメント）</p>
<p>以下のコードには<code class="docutils literal notranslate"><span class="pre">.reset_index(drop=True)</span></code>が追加されているが，これは行のインデックスを0,1,2,..と振り直すメソッドである。引数<code class="docutils literal notranslate"><span class="pre">drop=True</span></code>がなければ，元々あったインデックスが新たな列として追加される。試しに，最初から<code class="docutils literal notranslate"><span class="pre">df</span></code>を読み直して<code class="docutils literal notranslate"><span class="pre">.reset_index(drop=True)</span></code>を省いて下のコードを実行してみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;country&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">country</span></code>でグループ化した<code class="docutils literal notranslate"><span class="pre">df_group</span></code>を作成する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_group</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)</span>

<span class="n">df_group</span>
</pre></div>
</div>
</div>
</div>
<p>このコードの出力が示すように，<code class="docutils literal notranslate"><span class="pre">df_group</span></code>は<code class="docutils literal notranslate"><span class="pre">DataFrameGroupBy</span></code>というクラス名のオブジェクト（データ型）であり，<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>とは異なる。これによりグループ別の計算が格段と容易になる。</p>
<p>例えば，次のコードを使いそれぞれの経済の<code class="docutils literal notranslate"><span class="pre">gdp</span></code>の平均を計算することができる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_group</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">mean()</span></code>は<code class="docutils literal notranslate"><span class="pre">df_group</span></code>に備わるメソッドである。他にも便利な使い方があるが，ここでは変数の差分の作りかを説明する。</p>
<p><code class="docutils literal notranslate"><span class="pre">df_group</span></code>にある変数の差分をとるためにメソッド<code class="docutils literal notranslate"><span class="pre">diff()</span></code>を使う。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">,</span> <span class="s1">&#39;inv&#39;</span><span class="p">]</span>

<span class="n">df_diff</span> <span class="o">=</span> <span class="n">df_group</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>

<span class="n">df_diff</span>
</pre></div>
</div>
</div>
</div>
<p>次に<code class="docutils literal notranslate"><span class="pre">df</span></code>と<code class="docutils literal notranslate"><span class="pre">df_diff</span></code>を横に結合する。</p>
<p><strong>＜方法１：<code class="docutils literal notranslate"><span class="pre">pd.concat</span></code>＞</strong></p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">df_diff</span></code>の列名を変更</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pd.concat</span></code>を使い結合</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_diff_1</span> <span class="o">=</span> <span class="n">df_diff</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gdp&#39;</span><span class="p">:</span><span class="s1">&#39;gdp_diff&#39;</span><span class="p">,</span><span class="s1">&#39;inv&#39;</span><span class="p">:</span><span class="s1">&#39;inv_diff&#39;</span><span class="p">})</span>

<span class="n">df_diff_1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">df_diff_1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>上のコードの<code class="docutils literal notranslate"><span class="pre">axis='columns'</span></code>は<code class="docutils literal notranslate"><span class="pre">axis=1</span></code>としてもOK。この方法は、<code class="docutils literal notranslate"><span class="pre">df</span></code>と<code class="docutils literal notranslate"><span class="pre">df_diff_1</span></code>の行の順序が同じという想定のもとで行っている。行の順番が同じでない場合や不明な場合は、次の方法が良いであろう。</p>
<p><strong>＜方法２：<code class="docutils literal notranslate"><span class="pre">pd.merge</span></code>＞</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">df</span></code>と<code class="docutils literal notranslate"><span class="pre">df_diff</span></code>を使い、方法１の２つのステップを１行で済ませる。次のコードでは3つの引数を指定している。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">left_index=True</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">df</span></code>の行のインデックスに合わせて結合する。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">right_index=True</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">df_diff</span></code>の行のインデックスに合わせて結合する。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">suffixes=('',</span> <span class="pre">'_diff')</span></code></p>
<ul>
<li><p>左の引数<code class="docutils literal notranslate"><span class="pre">''</span></code>：結合後，重複する左の<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>の列につける接尾辞（空の接尾辞）</p></li>
<li><p>右の引数<code class="docutils literal notranslate"><span class="pre">'_diff'</span></code>：結合後，重複する右の<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>の列につける接尾辞</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df_diff</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;_diff&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">df</span></code>を上書きしたい場合は，<code class="docutils literal notranslate"><span class="pre">df=</span></code>を付け加える。</p>
</section>
<section id="id8">
<h2>１階差分推定<a class="headerlink" href="#id8" title="Link to this heading">#</a></h2>
<section id="id9">
<h3>説明<a class="headerlink" href="#id9" title="Link to this heading">#</a></h3>
<p>異質性バイアスの一番簡単な解決方法が１階差分推定（First Differenced Estimator）である。考え方は非常に簡単である。次の１階差分を定義する。</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\Delta y_{i}=y_{i1}-y_{i0}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\Delta D = D_{1}-D_0 =1-0= 1\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\Delta x_{i}=x_{i1}-x_{i0}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\Delta e_{i}=e_{i1}-e_{i0}=a_i+u_{i1}-\left(a_i+u_{i0}\right)=\Delta u_{i}\)</span></p>
<ul>
<li><p><span class="math notranslate nohighlight">\(a_i\)</span>が削除される。</p></li>
</ul>
</li>
</ul>
<p>これらを使い，上の式の１階差分をとると次式を得る。</p>
<div class="math notranslate nohighlight">
\[
\Delta y_{it}= \delta_0 + \beta_1\Delta x_{i}+\Delta u_{i}\qquad i=1,2,...,n
\]</div>
<ul class="simple">
<li><p>良い点</p>
<ul>
<li><p>（仮定により）<span class="math notranslate nohighlight">\(\Delta x_{i}\)</span>と<span class="math notranslate nohighlight">\(\Delta u_{i}\)</span>は相関しないため，GM仮定４は満たされることになる。</p></li>
</ul>
</li>
<li><p>悪い点</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(t=0\)</span>のデータを使えなくなるため，標本の大きさが小さくなる。</p></li>
<li><p>期間内の説明変数<span class="math notranslate nohighlight">\(\Delta x_i\)</span>の変化が小さいと，不正確な推定になる（極端な場合，変化がないと推定不可能となる）。</p></li>
</ul>
</li>
</ul>
<hr class="docutils" />
<p>＜推定方法＞</p>
<p>データから１階差分を計算し，<code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>を使いOLS推定すれば良い。以下ではパッケージ<code class="docutils literal notranslate"><span class="pre">wooldridge</span></code>にあるデータを使う。</p>
</section>
<section id="id10">
<h3>推定：２期間の場合<a class="headerlink" href="#id10" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>以下では<code class="docutils literal notranslate"><span class="pre">crime2</span></code>のデータを使い説明する。</p></li>
<li><p>このデータを使い，失業率が犯罪に負の影響を与えるかどうかを検証する。</p></li>
</ul>
<p>データの読み込み。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">crime2</span> <span class="o">=</span> <span class="n">wooldridge</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;crime2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>変数の説明。</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wooldridge</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;crime2&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>興味がある変数</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">crmes</span></code>：犯罪率（1000人当たり犯罪数）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unem</span></code>：失業率</p></li>
</ul>
<p>（コメント）</p>
<p>データセットにはこの2つの変数の差分（<code class="docutils literal notranslate"><span class="pre">cunem</span></code>と<code class="docutils literal notranslate"><span class="pre">ccrmrte</span></code>）も用意されているが，以下では<code class="docutils literal notranslate"><span class="pre">groupby</span></code>を使って変数を作成する。</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">crime2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>このデータセットには，観察単位識別用の変数がない。しかし，行0と1が1つの地域のデータ，行2と3が別の地域のデータをなっていることがわかる（<code class="docutils literal notranslate"><span class="pre">year</span></code>を見るとわかる）。まず観察単位識別用の列を作成する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 観察単位の数</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">crime2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

<span class="c1"># 観察単位ID用のリスト作成 [1,2,3,4....]</span>
<span class="n">lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>

<span class="c1"># 観察単位ID用のリスト作成 [1,1,2,2,3,3,4,4....]</span>
<span class="n">country_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">country_list</span></code>の説明：</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Series</span></code>のメソッド<code class="docutils literal notranslate"><span class="pre">repeat(2)</span></code>は<code class="docutils literal notranslate"><span class="pre">lst</span></code>の要素を２回リピートする<code class="docutils literal notranslate"><span class="pre">Series</span></code>を生成する。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">to_list()</span></code>は<code class="docutils literal notranslate"><span class="pre">Series</span></code>をリストに変換するメソッド。</p></li>
</ol>
<p>データセットに列<code class="docutils literal notranslate"><span class="pre">county</span></code>を追加し確認する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">crime2</span><span class="p">[</span><span class="s1">&#39;county&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">country_list</span>  <span class="c1"># 追加</span>

<span class="n">crime2</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;county&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>  <span class="c1"># 確認</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">unem</span></code>と<code class="docutils literal notranslate"><span class="pre">crmrte</span></code>の差分を求める。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;unem&#39;</span><span class="p">,</span> <span class="s1">&#39;crmrte&#39;</span><span class="p">]</span>  <span class="c1"># groupbyで差分を取る列の指定</span>

<span class="n">names</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;unem&#39;</span><span class="p">:</span><span class="s1">&#39;unem_diff&#39;</span><span class="p">,</span> <span class="s1">&#39;crmrte&#39;</span><span class="p">:</span><span class="s1">&#39;crmrte_diff&#39;</span><span class="p">}</span>  <span class="c1"># 差分の列のラベル</span>

<span class="n">crime2_diff</span> <span class="o">=</span> <span class="n">crime2</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;county&#39;</span><span class="p">)[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>

<span class="n">crime2_diff</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">crime2_diff</span></code>を使って回帰分析をおこなう。</p>
<p>（コメント）</p>
<p>以下の計算では<code class="docutils literal notranslate"><span class="pre">NaN</span></code>は自動的に無視される。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula_1</span> <span class="o">=</span> <span class="s1">&#39;crmrte_diff ~ unem_diff&#39;</span>

<span class="n">result_1</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">formula_1</span><span class="p">,</span> <span class="n">crime2_diff</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result_1</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>＜結果＞</p>
<ul class="simple">
<li><p>失業率が1%増加すると，犯罪率は約2.2%上昇する。</p>
<ul>
<li><p>この場合、微分を計算するのではなく、<code class="docutils literal notranslate"><span class="pre">unem_diff</span></code>に<code class="docutils literal notranslate"><span class="pre">1</span></code>を代入して解釈する。</p></li>
</ul>
</li>
<li><p>5％の水準で帰無仮説を棄却できる。</p></li>
<li><p>次の片側検定を行う</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(H_0\)</span>: <code class="docutils literal notranslate"><span class="pre">unem</span></code>の係数 <span class="math notranslate nohighlight">\(＝0\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(H_a\)</span>: <code class="docutils literal notranslate"><span class="pre">unem</span></code>の係数 <span class="math notranslate nohighlight">\(&gt;0\)</span></p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t_value</span> <span class="o">=</span> <span class="n">result_1</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="s1">&#39;unem_diff&#39;</span><span class="p">]</span>  <span class="c1"># t値</span>

<span class="n">dof</span> <span class="o">=</span> <span class="n">result_1</span><span class="o">.</span><span class="n">df_resid</span>  <span class="c1"># 自由度 n-k-1</span>

<span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">t_value</span><span class="p">,</span> <span class="n">dof</span><span class="p">)</span>  <span class="c1"># p値の計算</span>
</pre></div>
</div>
</div>
</div>
<p>片側検定では，1%水準で帰無仮説を棄却できる。</p>
<hr class="docutils" />
<p><strong>＜参考１＞</strong></p>
<p>１階差分推定を使わずに直接OLS推定するとどうなるかを確かめてみる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula_ols_1</span> <span class="o">=</span> <span class="s1">&#39;crmrte ~ d87 + unem&#39;</span>

<span class="n">result_ols_1</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">formula_ols_1</span><span class="p">,</span> <span class="n">crime2</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result_ols_1</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>失業の効果は過小評価されている。</p>
<ul>
<li><p>地域の異質性を考慮しなため異質性バイアス（欠落変数バイアス）が発生している。</p></li>
</ul>
</li>
<li><p>統計的有意性も低い（p値は非常に高い）。</p></li>
</ul>
<hr class="docutils" />
<p><strong>＜参考２＞</strong></p>
<p>参考１の回帰式にはダミー変数<code class="docutils literal notranslate"><span class="pre">d87</span></code>が入っており、年によって失業と犯罪の関係は異なることを捉えている。もしこのダミーが入らないと通常考えられる関係と逆の相関が発生する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula_ols_2</span> <span class="o">=</span> <span class="s1">&#39;crmrte ~ unem&#39;</span>

<span class="n">result_ols_2</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">formula_ols_2</span><span class="p">,</span> <span class="n">crime2</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result_ols_2</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id11">
<h3>推定：３期間以上の場合<a class="headerlink" href="#id11" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">crime4</span></code>のデータセットを使い，犯罪の決定要因について推定する。</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">crime4</span> <span class="o">=</span> <span class="n">wooldridge</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;crime4&#39;</span><span class="p">)</span>
<span class="n">crime4</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wooldridge</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;crime4&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>＜興味がある変数＞</p>
<ul class="simple">
<li><p>被説明変数</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">lcrmrte</span></code>：１人当たり犯罪数（対数）</p></li>
</ul>
</li>
<li><p>説明変数</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">lprbarr</span></code>：逮捕の確率（対数）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lprbconv</span></code>：有罪判決の確率（対数; 逮捕を所与として）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lprbpris</span></code>：刑務所に収監される確率（対数; 有罪判決を所与として）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lavgsen</span></code>：平均服役期間（対数）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lpolpc</span></code>：１人当たり警官数（対数）</p></li>
</ul>
</li>
</ul>
<p>それぞれの変数の差分も用意されているが，以下では列<code class="docutils literal notranslate"><span class="pre">county</span></code>をグループ化しそれらの値を計算する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># グループ化</span>
<span class="n">crime4_group</span> <span class="o">=</span> <span class="n">crime4</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;county&#39;</span><span class="p">)</span>

<span class="c1"># 差分を計算したい変数</span>
<span class="n">var</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lcrmrte&#39;</span><span class="p">,</span> <span class="s1">&#39;lprbarr&#39;</span><span class="p">,</span> <span class="s1">&#39;lprbconv&#39;</span><span class="p">,</span> <span class="s1">&#39;lprbpris&#39;</span><span class="p">,</span> <span class="s1">&#39;lavgsen&#39;</span><span class="p">,</span> <span class="s1">&#39;lpolpc&#39;</span><span class="p">]</span>

<span class="c1"># 差分のDataFrame</span>
<span class="n">crime4_diff</span> <span class="o">=</span> <span class="n">crime4_group</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>

<span class="c1"># DataFrameの結合</span>
<span class="n">crime4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">crime4</span><span class="p">,</span> <span class="n">crime4_diff</span><span class="p">,</span> 
                  <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;_diff&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p>推定式については，2期間モデルと同じように考える。違う点は，7年間の年次データであるため，６つの時間ダミー変数を入れることだけである。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula_2</span> <span class="o">=</span> <span class="s1">&#39;lcrmrte_diff ~ d83 + d84 + d85 + d86 + d87 + </span><span class="se">\</span>
<span class="s1">                            lprbarr_diff + lprbconv_diff + </span><span class="se">\</span>
<span class="s1">                            lprbpris_diff + lavgsen_diff + </span><span class="se">\</span>
<span class="s1">                            lpolpc_diff&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_2</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="n">formula_2</span><span class="p">,</span> <span class="n">crime4</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result_2</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>＜結果＞</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">lprbarr</span></code>（逮捕の確率），<code class="docutils literal notranslate"><span class="pre">lprbconv</span></code>（有罪判決の確率），<code class="docutils literal notranslate"><span class="pre">lprbpris</span></code>（収監確率），<code class="docutils literal notranslate"><span class="pre">lavgsen</span></code>（平均服役期間）は全て予想通りの結果。</p></li>
<li><p>しかし平均服役期間はの統計的優位性は低い。（犯罪予防効果は低い？）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lpolpc</span></code>（１人当たり警官数）の効果は正</p>
<ul>
<li><p>警官が多くなると，犯罪数が同じであっても犯罪の報告は増える？</p></li>
<li><p>同時性バイアス？</p></li>
</ul>
</li>
</ul>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="14_Hetero.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">不均一分散</p>
      </div>
    </a>
    <a class="right-next"
       href="16_linearmodels.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><code class="docutils literal notranslate"><span class="pre">linearmodels</span></code></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">説明</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">独立に分布したプーリング・データ</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">プーリング・データの応用：差分の差分析</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">説明</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#did"><code class="docutils literal notranslate"><span class="pre">DiD</span></code>推定</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">パネル・データとその問題点</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">パネル・データについて</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ols">OLS推定の問題点</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#groupby">１階差分推定の準備：<code class="docutils literal notranslate"><span class="pre">groupby</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">１階差分推定</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">説明</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">推定：２期間の場合</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">推定：３期間以上の場合</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By 春山 鉄源  Tetsugen HARUYAMA
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2020-2024（公開開始日：2020年5月4日）.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <!-- Default Statcounter code for Py4etrics https://py4etrics.github.io/ --> <script type="text/javascript"> var sc_project=12340470; var sc_invisible=1; var sc_security="72befddb"; </script> <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async></script> <noscript><div class="statcounter"><a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img class="statcounter" src="https://c.statcounter.com/12340470/0/72befddb/1/" alt="Web Analytics"></a></div></noscript> <!-- End of Statcounter Code -->
</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>